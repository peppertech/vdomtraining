{"version":3,"file":"useOutsideClick-6689a91c.js","sources":["../../src/hooks/UNSAFE_useOutsideClick/useOutsideClick.ts"],"sourcesContent":["/**\n * `useClickOutside` hook for capturing clicking outside of an element\n */\nimport { RefObject } from 'preact';\nimport { useEffect, useRef } from 'preact/hooks';\nimport { coerceArray } from '../../utils/UNSAFE_arrayUtils';\n\ntype Props = {\n  /**\n   * If true outside click is disabled\n   */\n  isDisabled?: boolean;\n  /**\n   * Reference to element or array of elements relative to which outside click is performed\n   */\n  ref: RefObject<HTMLElement> | RefObject<HTMLElement>[];\n  /**\n   * Outside click callback\n   */\n  handler?: (event: MouseEvent) => void;\n};\n\n/**\n * Checks if the mouse event target is inside of any of the specified containers, or if it\n * occurs in a layer whose 'logicalParent' belongs to one of the containers.\n *\n * @param event a mouse event associated with the potential \"outside click\" action\n * @param ref an array of references to elements that are considered \"inside\"\n * @returns 'true' if the event occurs \"outside\" of the specified list of containers\n */\nconst isPointOutside = (event: Event, ref: RefObject<HTMLElement>[]) => {\n  const target = event.target as HTMLElement;\n\n  // if the event has no target, consider it \"inside\"\n  if (!target) {\n    return false;\n  }\n\n  const doc = getDocument(target);\n  if (!doc.contains(target)) {\n    return false;\n  }\n\n  // if the target is contained in any of the target containers, it is not \"outside\"\n  if (ref.some((elRef) => elRef.current?.contains(target))) {\n    return false;\n  }\n\n  // the event target can aslo occur in a popup layer that belongs to an \"inside\" container\n\n  // get open layers under the layer host\n  const layerHostElem = doc.querySelector('#__root_layer_host');\n  let logicalParent: Element | null = null;\n\n  if (layerHostElem) {\n    const isTargetInLayer = layerHostElem.contains(target);\n\n    if (isTargetInLayer) {\n      for (let i = 0; i < layerHostElem.children.length; i++) {\n        const layerNode = layerHostElem.children[i] as any;\n        if (layerNode.contains(target)) {\n          logicalParent = layerNode['__oj_logical_parent'];\n          break;\n        }\n      }\n    }\n  }\n  // check if layer's 'logicalParent' is inside of any of the \"inside\" containers\n  return ref.every((elRef) => !elRef.current?.contains(logicalParent));\n};\n\nconst getDocument = (node?: Node): Document => node?.ownerDocument ?? document;\n\nexport const useOutsideClick = ({ isDisabled: disabled = false, ref, handler }: Props) => {\n  // use ref to store mutable data and not cause a re-render\n  const stateRef = useRef({\n    isMouseDown: false\n  });\n\n  const state = stateRef.current;\n\n  useEffect(() => {\n    const refs = coerceArray(ref);\n    if (\n      !handler ||\n      disabled ||\n      (refs.length > 0 && refs.findIndex((elRef) => elRef.current === null) > -1)\n    )\n      return;\n    const onMouseDown = () => {\n      state.isMouseDown = true;\n    };\n\n    const onMouseUp = (event: MouseEvent) => {\n      if (state.isMouseDown && isPointOutside(event, refs)) {\n        state.isMouseDown = false;\n        handler?.(event);\n      }\n    };\n    const firstElRef = refs[0];\n    const doc = getDocument(firstElRef.current!);\n    if (doc) {\n      doc.addEventListener('mousedown', onMouseDown, true);\n      doc.addEventListener('mouseup', onMouseUp, true);\n\n      return () => {\n        doc.removeEventListener('mousedown', onMouseDown, true);\n        doc.removeEventListener('mouseup', onMouseUp, true);\n      };\n    }\n    return undefined;\n  }, [disabled, handler, ref, state]);\n};\n"],"names":["getDocument","node","ownerDocument","document","isDisabled","disabled","ref","handler","state","useRef","isMouseDown","current","useEffect","refs","coerceArray","length","findIndex","elRef","onMouseDown","onMouseUp","event","target","doc","contains","some","layerHostElem","querySelector","logicalParent","i","children","layerNode","every","isPointOutside","firstElRef","addEventListener","removeEventListener"],"mappings":"wFA8BA,MAyCMA,EAAeC,GAA0BA,GAAMC,eAAiBC,2BAEvC,EAAGC,WAAYC,GAAW,EAAOC,MAAKC,cAEnE,MAIMC,EAJWC,EAAAA,OAAO,CACtBC,aAAa,IAGQC,QAEvBC,EAAAA,WAAU,KACR,MAAMC,EAAOC,cAAYR,GACzB,IACGC,GACDF,GACCQ,EAAKE,OAAS,GAAKF,EAAKG,WAAWC,GAA4B,OAAlBA,EAAMN,WAAqB,EAEzE,OACF,MAAMO,EAAc,KAClBV,EAAME,aAAc,CAAI,EAGpBS,EAAaC,IACbZ,EAAME,aAhEO,EAACU,EAAcd,KACpC,MAAMe,EAASD,EAAMC,OAGrB,IAAKA,EACH,OAAO,EAGT,MAAMC,EAAMtB,EAAYqB,GACxB,IAAKC,EAAIC,SAASF,GAChB,OAAO,EAIT,GAAIf,EAAIkB,MAAMP,GAAUA,EAAMN,SAASY,SAASF,KAC9C,OAAO,EAMT,MAAMI,EAAgBH,EAAII,cAAc,sBACxC,IAAIC,EAAgC,KAEpC,GAAIF,GACsBA,EAAcF,SAASF,GAG7C,IAAK,IAAIO,EAAI,EAAGA,EAAIH,EAAcI,SAASd,OAAQa,IAAK,CACtD,MAAME,EAAYL,EAAcI,SAASD,GACzC,GAAIE,EAAUP,SAASF,GAAS,CAC9BM,EAAgBG,EAA+B,oBAC/C,KACD,CACF,CAIL,OAAOxB,EAAIyB,OAAOd,IAAWA,EAAMN,SAASY,SAASI,IAAe,EA0BvCK,CAAeZ,EAAOP,KAC7CL,EAAME,aAAc,EACpBH,IAAUa,GACX,EAEGa,EAAapB,EAAK,GAClBS,EAAMtB,EAAYiC,EAAWtB,SACnC,OAAIW,GACFA,EAAIY,iBAAiB,YAAahB,GAAa,GAC/CI,EAAIY,iBAAiB,UAAWf,GAAW,GAEpC,KACLG,EAAIa,oBAAoB,YAAajB,GAAa,GAClDI,EAAIa,oBAAoB,UAAWhB,GAAW,EAAK,QANvD,CASgB,GACf,CAACd,EAAUE,EAASD,EAAKE,GAAO"}