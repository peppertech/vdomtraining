define(['exports', 'preact/jsx-runtime', './UNSAFE_PieChart/themes/PieChartStyles.css', './TrackResizeContainer-74ef32df', './pathUtils-ec75f879', './layoutUtils-ac40a238', './classNames-08d99695', './usePieChartNav-db1fd7a7', './useDatatip-87792500', './util-5bb1f200', './mergeProps-bcfa6a92', './VisTabularDatatip-1051eaca', './colorUtils-a785c4c4', './accUtils-1557920a', './useUser-85c781ea', './useTestId-3a316499', './useVisTouchResponse-36416652', 'preact/hooks', './stringUtils-0ae982c2'], (function(e,t,a,s,i,n,o,r,l,c,d,h,u,b,m,x,g,f,p){"use strict";const M=.45,v=.38,I=3,y=1.5,T=90;function j(e){return e*(Math.PI/180)}function w(e,t,a,s){const i=Math.atan2(s,a)-Math.atan2(t,e);return i<0?i+2*Math.PI:i}function C(e,t,a,s,n,o,r,l,c){const d=Math.max(s-e,0),h=Math.max(n-e,0),u=360==r||d<e?0:l+2*e,b=o?o+e:0,m=j(360==r?359.99:r),x=j(c),g=u/2,f=g<d?Math.asin(g/d):0,p=-m/2-x,M=Math.min(5*g,m>0?Math.abs(g/Math.sin(m/2)):0),v=0==d?M:M*h/d,I=t+Math.cos(p)*M,y=a+Math.sin(p)*v,T=t+Math.cos(-f-x)*d,C=a+Math.sin(-f-x)*h,R=t+Math.cos(-x-m+f)*d,P=a+Math.sin(-x-m+f)*h;let L,V=w(R-t,P-a,T-t,C-a);if(V=Math.min(V,m),b>0){const e=g<b?Math.asin(g/b):0,s=t+Math.cos(-e-x)*b,n=a+Math.sin(-e-x)*b,o=t+Math.cos(-x-m+e)*b,l=a+Math.sin(-x-m+e)*b;let c=w(o-t,l-a,s-t,n-a);c=Math.min(c,V,m),360==r?(L=i.moveTo(R,P),L+=i.arcTo(d,h,m,1,T,C),L+=i.lineTo(R,P),L+=i.moveTo(s,n),L+=i.arcTo(b,b,m,0,o,l)):(L=i.moveTo(o,l),L+=i.lineTo(R,P),L+=i.arcTo(d,h,V,1,T,C),L+=i.lineTo(s,n),L+=i.arcTo(b,b,c,0,o,l))}else 360==r?(L=i.moveTo(R,P),L+=i.arcTo(d,h,m,1,T,C)):(L=i.moveTo(I,y),L+=i.lineTo(R,P),L+=i.arcTo(d,h,V,1,T,C));return L+=i.closePath(),L}function R(e,t,a){return{innerBounds:{width:Math.sqrt(2)*a,height:Math.sqrt(2)*a,x:e-a/Math.sqrt(2),y:t-a/Math.sqrt(2)},outerBounds:{width:2*a,height:2*a,x:e-a,y:t-a}}}function P(e,t,a,s,i,n){return n?function(e,t,a,s,i,n){const o=(e+t/2)/180*Math.PI,r=(i+n)/2;return{x:a+r*Math.cos(o),y:s-r*Math.sin(o),width:0,height:0}}(e[n.itemIndex].startAngle,e[n.itemIndex].angleExtent,t,a,s,i):void 0}function L(e,t,a){return a?.color||null!=t?.itemIndex?e[t.itemIndex]:void 0}function V({cx:e,cy:s,r:i,startAngle:n,angleExtent:r,gap:l,innerRadius:c,color:d,id:h,itemIndex:u,isFocused:b=!1,isHovered:m=!1,...x}){const g=C(0,e,s,i,i,c,r,l,n);let f;return b?(f=C(2,e,s,i,i,c,r,l,n),t.jsxs("g",{id:h,role:x.accessibleLabel?"img":void 0,"data-oj-item-index":u,"data-oj-object":"pieSlice","aria-label":x.accessibleLabel,children:[t.jsx("path",{d:g,fill:d,stroke:d,className:a.styles.innerShapes}),t.jsx("path",{d:f,fill:d,className:o.classNames([a.styles.contrastBorder,a.styles.innerShapes])})]})):t.jsx("path",{role:x.accessibleLabel?"img":void 0,"aria-label":x.accessibleLabel,d:g,"data-oj-object":"pieSlice",fill:d,id:h,"data-oj-item-index":u})}const A=100;function N({width:e,height:s,testId:i,innerRadius:o=0,...b}){const j=f.useRef(null),w=u.getColorRamp(),{totalValue:C,isLabelOutside:N}=b.data.reduce((({totalValue:e,isLabelOutside:t},a)=>({totalValue:e+a.value,isLabelOutside:t})),{totalValue:0,isLabelOutside:!1});const S=function(e,t){let a,s=T;const i=[];for(let n=0;n<e.length;n++){const o=e[n],r=o.value;a=r===t?100:0===t?0:Math.min(r/t*100,99.99);const l=3.6*a;let c=s-l;c<0&&(c+=360),i.push({index:n,startAngle:c,angleExtent:l,...o}),s=c}return i}(b.data,C),U=function(e){return I*e}(.5),D=b.data.length>A,{direction:E}=m.useUser(),F=x.useTestId(i),k=n.getAvailSpace(e,s),{cx:O,cy:q}=function(e){return{cx:e.x+Math.floor(e.width/2),cy:e.y+Math.floor(e.height/2)}}(k),B=function(e,t){const a=t?v:M;return Math.floor(Math.min(e.width,e.height)*a)}(k,N),z=o*B,H=function(e,t,a){if(!t)return e;const s=2*Math.PI*a;let i=0;return e.filter((({startAngle:e,angleExtent:t})=>{const a=(t+e)/360*s;return!(t/360*s<y&&Math.abs(i-a)<y||(i=a,0))}))}(S,D,B),G=(_=H,J="rtl"===E,({itemIndex:e},t)=>{let a=e;return a=J&&("ArrowRight"===t||"ArrowUp"===t)||!J&&("ArrowLeft"===t||"ArrowDown"===t)?e-1:e+1,{itemIndex:(a%_.length+_.length)%_.length}});var _,J;const{touchResponse:K,touchResponseStyle:Q}=g.useVisTouchResponse({type:"auto",supportsTouchDragGestures:!1,rootRef:j}),{activeId:W,navProps:X,focusedItemInfo:Y,hoveredItemInfo:Z}=r.usePieChartNav({touchResponse:K,getNextChartItem:G}),$=Y.isFocusVisible?Y:Z,ee=$?b.data[H[$.itemIndex].index]:void 0,{content:te,borderColor:ae}=ee&&b.datatip?b.datatip({data:ee}):((e,a)=>e?e.accessibleLabel?{content:e.accessibleLabel,borderColor:L(w,a,e)}:{content:t.jsx(h.VisTabularDatatip,{tableData:[{key:"Value",value:e.value}]}),borderColor:L(w,a,e)}:{content:void 0,borderColor:void 0})(ee,$),se=Y.isFocusVisible?"element":"pointer",ie=$?.isFocusVisible?P(H,O,q,z,B,$):void 0,{datatipContent:ne,datatipProps:oe}=l.useDatatip({content:te,offset:c.calculateOffset("rtl"===E,e,ie),anchor:se,placement:"top-start",borderColor:ae,touchResponse:K});oe["aria-describedby"]=p.merge([b["aria-describedby"],oe["aria-describedby"]]);const re=d.mergeProps(X,oe);return t.jsxs("div",{ref:j,tabIndex:0,"aria-label":b["aria-label"],"aria-labelledby":b["aria-labelledby"],"aria-activedescendant":W,role:"application",...re,...F,className:a.styles.chart,style:{width:e,height:s,...Q},children:[H.length>0&&t.jsx("svg",{className:a.styles.svg,children:H.map(((e,a)=>t.jsx(V,{cx:O,cy:q,itemIndex:a,id:$?.itemIndex===a?W:void 0,isFocused:Y?.itemIndex===a&&Y?.isFocusVisible,isHovered:Z?.itemIndex===a,r:B,startAngle:e.startAngle,gap:U,innerRadius:z,angleExtent:e.angleExtent,color:e.color||w[a%w.length],accessibleLabel:e.accessibleLabel},e.id)))}),b.children?.(R(O,q,z)),ne]})}e.PieChart=function({width:e,height:i,...n}){return t.jsx(s.TrackResizeContainer,{width:e,height:i,class:a.dimensionStyle,children:(e,a)=>t.jsx(N,{width:e,height:a,...n})})}}));
//# sourceMappingURL=PieChart-cbe2806f.js.map
