{"version":3,"file":"useChartDrill-fb4fb6f9.js","sources":["../../src/hooks/PRIVATE_useChartDrill/useChartDrill.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { Ref } from 'preact/hooks';\nimport { Group } from '../../UNSAFE_Axis/axis.types';\nimport { getInfo } from '../../utils/UNSAFE_visUtils';\nimport { ChartItem, GroupInfo, Info } from '../../UNSAFE_Chart';\n\ntype DrillEventsProps<D> = {\n  rootRef: Ref<HTMLDivElement>;\n  groups: Group[];\n  focusedItemInfo: Info;\n  focusedGroupInfo: GroupInfo;\n  selectionMode: 'none' | 'single' | 'multiple';\n  getDataItem: (seriesIndex: number, groupIndex: number) => D | undefined;\n  drilling: 'on' | 'groupsOnly' | 'off';\n  onItemDrill?: (detail: any) => void;\n  onGroupDrill?: (detail: any) => void;\n};\n\nconst isDrillable = <K extends string | number, D extends ChartItem<K>>(\n  info: { seriesIndex?: number; groupIndex?: number },\n  drilling: 'on' | 'groupsOnly' | 'off',\n  groups: Group[],\n  getDataItem: (seriesIndex: number, groupIndex: number) => D | undefined\n) => {\n  const { seriesIndex, groupIndex } = info;\n\n  if (groupIndex === undefined) {\n    return false;\n  }\n\n  if (seriesIndex != null) {\n    const itemDrilling = getDataItem(seriesIndex, groupIndex)?.drilling != 'off';\n    return drilling === 'on' && itemDrilling;\n  } else {\n    return groups[groupIndex].drilling != 'off';\n  }\n};\n\n/**\n * Returns the event handlers for drill support.\n */\nexport function useChartDrill<K extends string | number, D extends ChartItem<K>>({\n  rootRef,\n  focusedItemInfo,\n  focusedGroupInfo,\n  groups,\n  selectionMode,\n  drilling,\n  getDataItem,\n  onItemDrill,\n  onGroupDrill\n}: DrillEventsProps<D>) {\n  const processDrill = (info?: { seriesIndex?: number; groupIndex?: number }) => {\n    if (\n      !info ||\n      info.groupIndex == undefined ||\n      !isDrillable(info, drilling, groups, getDataItem)\n    ) {\n      return;\n    }\n\n    const { seriesIndex, groupIndex } = info;\n\n    if (seriesIndex != null) {\n      const data = getDataItem(seriesIndex, groupIndex);\n      onItemDrill?.({\n        groupIndex,\n        seriesIndex,\n        data,\n        id: data?.id\n      });\n    } else {\n      onGroupDrill?.({\n        groupIndex,\n        group: groups[groupIndex],\n        id: groups[groupIndex].id\n      });\n    }\n  };\n\n  const onPointerUp = (event: PointerEvent) => {\n    if (selectionMode != 'none') {\n      return;\n    }\n    processDrill(getInfo(rootRef, event));\n  };\n\n  const onDblClick = (event: MouseEvent) => {\n    if (selectionMode === 'none') {\n      return;\n    }\n    processDrill(getInfo(rootRef, event));\n  };\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    if (event.key != 'Enter') {\n      return;\n    }\n    const focusedInfo = focusedItemInfo.isCurrent ? focusedItemInfo : focusedGroupInfo;\n    processDrill(focusedInfo);\n  };\n\n  return {\n    onPointerUp,\n    onDblClick,\n    onKeyDown\n  };\n}\n"],"names":["rootRef","focusedItemInfo","focusedGroupInfo","groups","selectionMode","drilling","getDataItem","onItemDrill","onGroupDrill","processDrill","info","undefined","groupIndex","seriesIndex","itemDrilling","isDrillable","data","id","group","onPointerUp","event","getInfo","onDblClick","onKeyDown","key","focusedInfo","isCurrent"],"mappings":"gHAgDM,UAA2EA,QAC/EA,EAAOC,gBACPA,EAAeC,iBACfA,EAAgBC,OAChBA,EAAMC,cACNA,EAAaC,SACbA,EAAQC,YACRA,EAAWC,YACXA,EAAWC,aACXA,IAEA,MAAMC,EAAgBC,IACpB,IACGA,GACkBC,MAAnBD,EAAKE,aArCS,EAClBF,EACAL,EACAF,EACAG,KAEA,MAAMO,YAAEA,EAAWD,WAAEA,GAAeF,EAEpC,QAAmBC,IAAfC,EACF,OAAO,EAGT,GAAmB,MAAfC,EAAqB,CACvB,MAAMC,EAAiE,OAAlDR,EAAYO,EAAaD,IAAaP,SAC3D,MAAoB,OAAbA,GAAqBS,CAC7B,CACC,MAAsC,OAA/BX,EAAOS,GAAYP,QAC3B,EAqBIU,CAAYL,EAAML,EAAUF,EAAQG,GAErC,OAGF,MAAMO,YAAEA,EAAWD,WAAEA,GAAeF,EAEpC,GAAmB,MAAfG,EAAqB,CACvB,MAAMG,EAAOV,EAAYO,EAAaD,GACtCL,IAAc,CACZK,aACAC,cACAG,OACAC,GAAID,GAAMC,IAEb,MACCT,IAAe,CACbI,aACAM,MAAOf,EAAOS,GACdK,GAAId,EAAOS,GAAYK,IAE1B,EAyBH,MAAO,CACLE,YAvBmBC,IACE,QAAjBhB,GAGJK,EAAaY,EAAOA,QAACrB,EAASoB,GAAO,EAoBrCE,WAjBkBF,IACI,SAAlBhB,GAGJK,EAAaY,EAAOA,QAACrB,EAASoB,GAAO,EAcrCG,UAXiBH,IACjB,GAAiB,SAAbA,EAAMI,IACR,OAEF,MAAMC,EAAcxB,EAAgByB,UAAYzB,EAAkBC,EAClEO,EAAagB,EAAY,EAQ7B"}