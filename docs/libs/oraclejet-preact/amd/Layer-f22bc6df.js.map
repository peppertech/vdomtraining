{"version":3,"file":"Layer-f22bc6df.js","sources":["../../src/UNSAFE_Layer/Layer.tsx"],"sourcesContent":["import { VNode, RefObject } from 'preact';\nimport { createPortal, useContext, useLayoutEffect, useMemo, useState } from 'preact/compat';\nimport { LayerContext, LayerPriority } from './LayerContext';\nimport { useThemeInterpolations } from '../hooks/UNSAFE_useThemeInterpolations/useThemeInterpolations';\n\nconst _LOGICAL_PARENT = '__oj_logical_parent';\n\ntype Props = {\n  /**\n   * The content to be re-parented using Portal\n   */\n  children: VNode;\n  /**\n   * Logical parent of the re-parented content. Typically the 'launcher' associated\n   * with the popup.\n   */\n  logicalParentRef?: RefObject<Element> | null;\n  /**\n   * Determines Layer's stacking context. Components that always need to render on top of other popup\n   * elements (such as Messages) should use priority='top'. The default priority level is 'normal'.\n   */\n  priority?: LayerPriority;\n};\n\ntype LayerElement = HTMLDivElement & {\n  __oj_logical_parent?: Element | null;\n};\n\nconst Layer = (props: Props) => {\n  const context = useContext(LayerContext);\n  // the 'top' priority should always win regardless of whether it comes from context or prop\n  const computedPriority =\n    props.priority === 'top' || context.priority === 'top' ? 'top' : props.priority;\n  const defaultHost = context.getHost?.(computedPriority);\n  const host = useMemo(() => defaultHost, [defaultHost]);\n\n  const [layerContainer, setLayerContainer] = useState<Element | null>(null);\n\n  // because the children are being rendered into a portal that is out of the flow of parent dom,\n  // we need to specify the colorScheme and scale class names here to pick up the correct CSS styles.\n  const classes = useThemeInterpolations();\n\n  // Really need useLayoutEffect instead of useEffect here. Otherwise the re-parented\n  // content does not get re-rendered with valid ref's\n  useLayoutEffect(() => {\n    if (!host) return;\n    const doc = host.ownerDocument ?? document;\n    const layer: LayerElement = doc.createElement('div');\n\n    if (props.logicalParentRef) {\n      layer[_LOGICAL_PARENT] = props.logicalParentRef.current;\n    }\n\n    host.appendChild(layer);\n    setLayerContainer(layer);\n\n    return () => {\n      if (host && layer && host.contains(layer)) {\n        delete layer[_LOGICAL_PARENT];\n        host.removeChild(layer);\n      }\n      setLayerContainer(null);\n    };\n  }, [host, props.logicalParentRef]);\n\n  // add the colorScheme and scale classes if there is a layerContainer\n  if (layerContainer) {\n    // use the theme interpolations to set the appropriate style classes for colorScheme and scale\n    layerContainer.className = classes;\n  }\n\n  let newLayerContext = {};\n\n  if (context.getHost) {\n    newLayerContext = {\n      // once 'priority' has been set to 'top', all children should render in the priority layer host\n      priority: computedPriority,\n      getHost: context.getHost\n    };\n  }\n\n  return (\n    <LayerContext.Provider value={newLayerContext}>\n      {layerContainer && createPortal(props.children, layerContainer)}\n    </LayerContext.Provider>\n  );\n};\n\nexport default Layer;\n"],"names":["_LOGICAL_PARENT","props","context","useContext","LayerContext","computedPriority","priority","defaultHost","getHost","host","useMemo","layerContainer","setLayerContainer","useState","classes","useThemeInterpolations","useLayoutEffect","layer","ownerDocument","document","createElement","logicalParentRef","current","appendChild","contains","removeChild","className","newLayerContext","_jsx","Provider","value","children","createPortal"],"mappings":"wJAKA,MAAMA,EAAkB,8BAuBTC,IACb,MAAMC,EAAUC,aAAWC,EAAAA,cAErBC,EACe,QAAnBJ,EAAMK,UAA2C,QAArBJ,EAAQI,SAAqB,MAAQL,EAAMK,SACnEC,EAAcL,EAAQM,UAAUH,GAChCI,EAAOC,EAAAA,SAAQ,IAAMH,GAAa,CAACA,KAElCI,EAAgBC,GAAqBC,EAAQA,SAAiB,MAI/DC,EAAUC,EAAAA,yBAIhBC,EAAAA,iBAAgB,KACd,IAAKP,EAAM,OACX,MACMQ,GADMR,EAAKS,eAAiBC,UACFC,cAAc,OAS9C,OAPInB,EAAMoB,mBACRJ,EAAMjB,GAAmBC,EAAMoB,iBAAiBC,SAGlDb,EAAKc,YAAYN,GACjBL,EAAkBK,GAEX,KACDR,GAAQQ,GAASR,EAAKe,SAASP,YAC1BA,EAAMjB,GACbS,EAAKgB,YAAYR,IAEnBL,EAAkB,KAAK,CACxB,GACA,CAACH,EAAMR,EAAMoB,mBAGZV,IAEFA,EAAee,UAAYZ,GAG7B,IAAIa,EAAkB,CAAA,EAUtB,OARIzB,EAAQM,UACVmB,EAAkB,CAEhBrB,SAAUD,EACVG,QAASN,EAAQM,UAKnBoB,MAACxB,EAAYA,aAACyB,SAAS,CAAAC,MAAOH,EAC3BI,SAAApB,GAAkBqB,EAAYA,aAAC/B,EAAM8B,SAAUpB,IAElD"}