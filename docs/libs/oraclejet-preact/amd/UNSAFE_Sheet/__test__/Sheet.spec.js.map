{"version":3,"file":"Sheet.spec.js","sources":["../../../../src/UNSAFE_Sheet/__test__/Sheet.spec.tsx"],"sourcesContent":["import { fireEvent, render, waitFor, screen } from '@testing-library/preact';\n\nimport { ComponentProps } from 'preact';\n\nimport { RootEnvironmentProvider } from '../../UNSAFE_Environment';\nimport { expect } from 'chai';\nimport { spy } from 'sinon';\nimport { useRef, useCallback, useState } from 'preact/hooks';\nimport userEvent from '@testing-library/user-event';\nimport { BaseButton } from '../../UNSAFE_BaseButton';\nimport { Sheet } from '../Sheet';\nimport { getClientHints } from '../../utils/PRIVATE_clientHints';\nimport { Button } from '../../UNSAFE_Button';\n\n//TODO: JET-63873\nfunction getSheet(elem: Element) {\n  return elem.querySelector('#contentId') as HTMLElement;\n}\nfunction getSheetContainer(elem: Element) {\n  return (elem.querySelector('#contentId') as Element).parentElement as HTMLElement;\n}\n\nfunction getSheetScrim(sheetContainer: Element) {\n  return sheetContainer.parentElement?.parentElement?.parentElement?.firstElementChild;\n}\n\nconst SheetSimpleComponent = ({\n  onClose\n}: {\n  onClose?: ComponentProps<typeof Sheet>['onClose'];\n}) => {\n  const ref = useRef<HTMLButtonElement>(null);\n\n  return (\n    <>\n      <RootEnvironmentProvider>\n        <BaseButton ref={ref}>Open</BaseButton>\n        <Sheet isOpen={true} onClose={onClose}>\n          <div\n            style={{ display: 'flex', flexDirection: 'column', outlineStyle: 'none' }}\n            id=\"contentId\">\n            <h1>N1</h1>\n            <h1>N2</h1>\n            <h1>N3</h1>\n            <h1>N4</h1>\n          </div>\n        </Sheet>\n      </RootEnvironmentProvider>\n    </>\n  );\n};\n\nfunction IntitialFocusTestComponent() {\n  const [isOpen, setIsOpen] = useState(false);\n  const toggleButtonRef = useRef<HTMLButtonElement>(null);\n\n  const toggle = useCallback(() => {\n    setIsOpen(!isOpen);\n  }, [isOpen]);\n  return (\n    <RootEnvironmentProvider>\n      <div\n        style={{\n          paddingTop: '90px',\n          paddingBottom: '90px'\n        }}>\n        <Sheet isOpen={isOpen} initialFocus=\"firstFocusable\">\n          <div\n            style={{ display: 'flex', flexDirection: 'column', outlineStyle: 'none' }}\n            id=\"contentId\">\n            <Button aria-label=\"OK\" label=\"OK\"></Button>\n          </div>\n        </Sheet>\n        <Button ref={toggleButtonRef} onAction={toggle} label=\"Toggle\" />\n      </div>\n    </RootEnvironmentProvider>\n  );\n}\n\ndescribe('Test Sheet Component', () => {\n  it('Sheet content render correctly', async function () {\n    const { container } = render(<SheetSimpleComponent />);\n\n    const sheetContent = getSheet(container);\n\n    expect(sheetContent).not.null;\n  });\n\n  it('onClose called when Escape or Tab are pressed', async function () {\n    const onActionDummyFunction = spy();\n    const { container } = render(<SheetSimpleComponent onClose={onActionDummyFunction} />);\n\n    const sheetContent = getSheet(container);\n    const sheetContainer = getSheetContainer(container);\n\n    expect(sheetContent).not.null;\n\n    fireEvent.keyDown(sheetContainer, { code: 'Tab' });\n    fireEvent.keyDown(sheetContainer, { code: 'Escape' });\n    expect(onActionDummyFunction.calledTwice).to.be.true;\n  });\n\n  it('onClose called when clicking scrim', async function () {\n    const onActionDummyFunction = spy();\n    const { container } = render(<SheetSimpleComponent onClose={onActionDummyFunction} />);\n    const sheetContent = getSheet(container);\n    const sheetContainer = getSheetContainer(container);\n    const sheetScrim = getSheetScrim(sheetContainer);\n\n    expect(sheetContent).not.null;\n\n    await userEvent.click(sheetScrim as HTMLElement);\n\n    expect(onActionDummyFunction.called).to.be.true;\n  });\n\n  it('onClose called when swipe is done (mobile)', async function () {\n    const onActionDummyFunction = spy();\n    const { container } = render(<SheetSimpleComponent onClose={onActionDummyFunction} />);\n    const sheetContent = getSheet(container);\n    const sheetContainer = getSheetContainer(container);\n    expect(sheetContent).not.null;\n\n    if (typeof jest === 'undefined' && getClientHints().touchSupport === 'primary') {\n      // Touch objects are created so we can replicate this in fake touch events\n      // This stuff is based on what useSwipe triggers and could change depending on the final decision\n      // on what events to trigger on useSwipe.\n      const touch1 = new Touch({\n        target: sheetContainer as EventTarget,\n        identifier: 0,\n        pageX: 386,\n        pageY: 224\n      });\n      const touch2 = new Touch({\n        target: sheetContainer as EventTarget,\n        identifier: 0,\n        pageX: 389,\n        pageY: 397\n      });\n      if (sheetContainer) {\n        fireEvent.touchStart(sheetContainer, {\n          timeStamp: 10406,\n          currentTarget: sheetContainer,\n          changedTouches: [touch1]\n        });\n        fireEvent.touchEnd(sheetContainer, {\n          timeStamp: 10472,\n          currentTarget: sheetContainer,\n          changedTouches: [touch2]\n        });\n      }\n      expect(onActionDummyFunction.called).to.be.true;\n    }\n  });\n\n  it('Sheet correct focus when initialFocus set as firstFocusable', async function () {\n    const { container } = render(<IntitialFocusTestComponent />);\n    const anchorButton = screen.getByRole('button');\n    expect(anchorButton, 'anchor element found').not.null;\n    if (anchorButton) {\n      await userEvent.click(anchorButton);\n    }\n    await waitFor(() => {\n      const sheet = getSheet(container);\n      expect(sheet).not.to.be.null;\n    });\n    const okButton = screen.getByLabelText('OK');\n    expect(okButton).not.to.be.null;\n    if (typeof jest === 'undefined') {\n      await waitFor(() => {\n        expect(okButton.matches(':focus')).to.be.true;\n      });\n    }\n  });\n});\n"],"names":["getSheet","elem","querySelector","getSheetContainer","parentElement","SheetSimpleComponent","onClose","ref","useRef","_jsx","_Fragment","children","_jsxs","jsxs","RootEnvironmentProvider","jsx","BaseButton","Sheet","isOpen","style","display","flexDirection","outlineStyle","id","IntitialFocusTestComponent","setIsOpen","useState","toggleButtonRef","toggle","useCallback","paddingTop","paddingBottom","initialFocus","Button","label","onAction","describe","it","async","container","render","sheetContent","expect","not","null","onActionDummyFunction","spy","sheetContainer","fireEvent","keyDown","code","calledTwice","to","be","true","sheetScrim","firstElementChild","getSheetScrim","userEvent","click","called","jest","getClientHints","touchSupport","touch1","Touch","target","identifier","pageX","pageY","touch2","touchStart","timeStamp","currentTarget","changedTouches","touchEnd","anchorButton","screen","getByRole","waitFor","sheet","okButton","getByLabelText","matches"],"mappings":"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"}