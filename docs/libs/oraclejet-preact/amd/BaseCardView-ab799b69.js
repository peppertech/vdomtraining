define(['exports', 'preact/jsx-runtime', 'preact', 'preact/compat', 'preact/hooks', './mergeProps-bcfa6a92', './keys-4755c121', './collectionUtils-17f5cc64', './useCurrentKey-a993db56', './useCollectionFocusRing-66a6fc12', './useTabbableModeSet-dc176f1d', './useSelection-4249360e', './LayerHost-639b3284', 'css!./DragAndDropStyles.styles.css', 'css!./ReorderableItemStyles.styles.css', './ReorderableContext-6d10a1b7', './Selector-2b0c34a7', './HiddenAccessible-037ef42d', './LoadMoreCollection-83413a59', './PRIVATE_BaseCardView/themes/BaseCardViewStyles.css', './classNames-08d99695', './refUtils-d354a169', './logger-0f873e29', './tabbableUtils-85aa6918', './useId-c9578d26', './useAnimation-5a74955f', './useResizeObserver-275c3e83', './TabbableModeContext-a9c97640', './FocusTrap-60520575', './useUser-3ef25571', './useReorderableItem-726c3c03', './useReorderableContext-a5453bd7', './Grid-8911aa0f', './Flex-3421f0df', './PRIVATE_BaseCardView/themes/BaseCardViewContract.css', './Skeleton-5839404b', './useCurrentItemOverride-bb6266d0', 'module'], (function(e,t,r,s,n,o,a,i,l,c,d,u,y,m,f,h,g,x,b,C,p,S,R,v,E,I,T,w,A,K,L,O,j,k,M,D,P,F){"use strict";function V({currentKey:e,children:r,dragKey:s,setDragKey:o,onReorder:l,rootRef:c,gutterSize:d,columns:u,context:y}){const m=n.useRef(null),f=1===u,h=y.index%u==0,g=y.index%u==u-1,x=C.multiVariantStyles({itemOverlayFront:d}),b=C.multiVariantStyles({itemOverlayFrontVertical:d}),S={itemOverlayFront:f?b:x,itemOverlayRear:f?C.styles.itemOverlayRearVertical:C.styles.itemOverlayRear,itemDragger:C.styles.itemDragger},R=n.useCallback((()=>m?.current?.closest(i.ITEM_SELECTOR)),[]),v=n.useCallback((e=>{e.dataTransfer?.setData("text/cardview-items-key",JSON.stringify(y.metadata.key))}),[y.metadata.key]),{rootProps:E,isDragged:I,overlayZoneBeforeProps:T,overlayZoneAfterProps:w}=L.useReorderableItem({isDisabled:!l,dragKey:s,setDragKey:o,onReorder:l,rootRef:c,ref:m,getItem:R,setTransferData:v,itemStyles:S,itemSelector:i.ITEM_SELECTOR,isVertical:f}),{currentItemKey:A}=O.useReorderableContext();n.useEffect((()=>{e===y.metadata.key&&(A.current=e)}),[e,y,A]);const{direction:j}=K.useUser(),k="rtl"===j,M=p.classNames([T?.class,!f&&!k&&h&&C.styles.itemOverlayFrontEdge,!f&&k&&g&&C.styles.itemOverlayFrontEdge]),D=p.classNames([w?.class,!f&&!k&&g&&C.styles.itemOverlayRearEdge,!f&&k&&h&&C.styles.itemOverlayRearEdge]);return t.jsxs("div",{...E,children:[r,!I&&a.isKeyDefined(s)&&t.jsxs(t.Fragment,{children:[t.jsx("div",{...T,class:M}),t.jsx("div",{...w,class:D})]})]})}const B=e=>({animationStates:{slideUp:{from:{translateY:"50px"},to:{translateY:"0px"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}},slideDown:{from:{translateY:"-50px"},to:{translateY:"0"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}}},isAnimatedOnMount:!0}),_=(e,t)=>({animationStates:{opacity:{from:{opacity:0},to:{opacity:1},options:{duration:150,delay:50*e,easing:"linear"}}},isAnimatedOnMount:!0,onAnimationEnd:()=>{t.current&&clearTimeout(t.current)}}),z=s.memo((function({children:e,context:r,isTabbable:s,isFocused:o,isFocusRingVisible:a,isSelected:i,selectionMode:l,focusBehavior:c,setIsFocusBehaviorValid:d,initialAnimation:u,isGridLayout:y,updateCardSize:m,reorderItemProps:f}){const h=n.useRef(null),g=n.useRef(),x=r.metadata.key,b=r.index,K=o&&a,L=C.multiVariantStyles({itemFocused:"card"===c&&K?"isItemFocused":"isNotItemFocused",itemInitialOpacity:u?"isTransparent":"isNotTransparent",itemInGridLayout:y?"isInGridLayout":"isNotInGridLayout"}),O=p.classNames([C.styles.itemStyle,L]),j=n.useCallback((e=>{m?.(e.contentRect.width,e.contentRect.height)}),[m]),k=n.useRef(null);T.useResizeObserver(m?h:k,j),n.useLayoutEffect((()=>{if("content"===c&&K){const e=h.current?.firstElementChild?.firstElementChild,t=v.allTabbableElements(e,!0,!0);0===t.length||t.length>1?(R.warn(`${t.length} focusable elements are detected in the card. 'content' focusBehavior is intended only for use when the card has single focusable element. Please specify one focusable element in the card or switch the focusBehavior to 'card'.`),d?.(!1)):t[0].focus()}}),[c,K,d]);const{nodeRef:M,controller:D}=I.useAnimation(u||"none",B(b)),{nodeRef:P,controller:F}=I.useAnimation(u?"opacity":"none",_(b,g));n.useEffect((()=>{void 0!==u&&(g.current=setTimeout((()=>{D.cancel(),F.cancel(),h.current&&(h.current.style.opacity="1")}),1e3))}),[F,D,u]);const z=n.useMemo((()=>void 0===u?S.mergeRefs(h):S.mergeRefs(h,M,P)),[h,M,P,u]),N=f?t.jsx(V,{...f,context:r,children:e(r)}):e(r);return t.jsx("div",{id:E.useId(),ref:z,class:O,role:"gridcell","data-oj-key":x,onKeyDown:e=>{"card"!==c||!s||"ArrowDown"!==e.key&&"ArrowUp"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},"aria-selected":"none"===l?void 0:i,..."number"==typeof x&&{"data-oj-key-type":"number"},children:t.jsx(w.TabbableModeContext.Provider,{value:{isTabbable:s},children:t.jsx(A.FocusTrap,{isDisabled:!s,restoreFocusRef:!1,children:N})})})}),((e,t)=>{return!(!e||!t)&&(e.children===t.children&&e.isTabbable===t.isTabbable&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.initialAnimation===t.initialAnimation&&e.focusBehavior===t.focusBehavior&&i.compareListItemContext(e.context,t.context)&&(r=e.reorderItemProps,s=t.reorderItemProps,r?.currentKey===s?.currentKey&&r?.dragKey===s?.dragKey&&r?.columns===s?.columns));var r,s}));function N({children:e,layout:r,gutterSize:s,columns:n}){const o=M.cardViewVars.gutterSize[s];return"grid"===r?n<1?null:t.jsx(j.Grid,{gridTemplateColumns:`repeat(${n}, 1fr)`,gap:o,children:e}):t.jsx(k.Flex,{wrap:"wrap",gap:o,children:e})}function U({children:e}){const[s,o]=n.useState(!1);return n.useEffect((()=>{setTimeout((()=>{o(!0)}),50)}),[]),s?t.jsx(r.Fragment,{children:e}):t.jsx("div",{class:b.LOADMORE_STYLE_CLASS})}const Y=(e,r=25,s,n,o=!0)=>{const a=s||("flex"===e?"60x":"100%"),i=n||"70x";return[...Array(r)].map(((e,r)=>t.jsx(D.Skeleton,{width:a,height:i},o&&`${r}${(new Date).getTime()}`)))},H=e=>t.jsx(U,{children:Y(e.layout)}),G=e=>{const r=[t.jsx("div",{class:b.LOADMORE_STYLE_CLASS,children:Y(e.layout,1)}),...Y(e.layout,24)];return t.jsx(U,{children:r})},$=()=>t.jsx("div",{class:b.LOADMORE_STYLE_CLASS}),W=e=>{if(e.colCount<1||null==e.cardWidth||null==e.cardHeight)return t.jsx($,{});{const r=[],s=e.colCount-e.totalCount%e.colCount,n=s===e.colCount,o=`calc(${e.cardWidth}px)`,a=e.cardHeight?`calc(${e.cardHeight}px)`:"70x",i="flex"===e.layout?o:"100%",l="flex"===e.layout||n?a:"100%",c=t.jsx("div",{class:b.LOADMORE_STYLE_CLASS,children:Y(e.layout,1,i,l)});return r.push(c),r.push(Y(e.layout,s-1,i,l)),n||r.push(Y(e.layout,e.colCount,i,a)),t.jsx(U,{children:r})}},Z={all:!1,keys:new Set},J={xs:12,sm:16,md:24,lg:48,xl:64},X=s.forwardRef((({children:e,data:s,onLoadMore:y=(()=>{}),hasMore:m=!1,getRowKey:f,currentItemOverride:p,onPersistCurrentItem:S,selectionMode:R="none",selectedKeys:v=Z,onSelectionChange:E,onReorder:I,viewportConfig:T,focusBehavior:w="card","aria-label":A,"aria-labelledby":K,initialAnimation:O="slideUp",gutterSize:j="sm",columns:k,layout:M,cardSize:D,updateCardSize:F,skeletonRenderer:V},B)=>{const _=n.useRef(null);n.useImperativeHandle(B,(()=>_.current),[_]);const Y=n.useRef(),$=n.useRef(),X=n.useRef(!0),te=J[j],re={layout:M,columns:k,gutterSize:j},se=n.useRef(!0);n.useEffect((()=>{null!=D.height&&null!=D.width&&(se.current=!1)}),[D]);const ne="none"===R?void 0:"multiple"===R,oe=m||!s||k<1?-1:Math.ceil(s?.length/k),ae=k<1?-1:k,[ie,le]=n.useState(!0),ce=ie?w:"card",de=n.useRef(!1),ue=null!=I,ye=n.useRef(!1),{currentKey:me,onCurrentKeyChange:fe,isCurrentItemOverridden:he}=P.useCurrentItemOverride(p,S),[ge,xe]=d.useTabbableModeSet(_,(e=>i.keyExtractor(e,i.ITEM_SELECTOR)),me,fe),{currentKeyProps:be}=l.useCurrentKey((e=>i.keyExtractor(e,i.ITEM_SELECTOR)),"multiple"!==R,(()=>i.getPrevNextKeyByCount(s,f,me,-k)),(()=>i.getPrevNextKeyByCount(s,f,me,k)),(()=>i.getPrevNextKeyByCount(s,f,me,-1)),(()=>i.getPrevNextKeyByCount(s,f,me,1)),me,fe),[Ce,pe]=c.useCollectionFocusRing(_,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]),Se=n.useCallback((e=>{const t=i.keyExtractor(e.target,i.ITEM_SELECTOR);a.isKeyDefined(t)&&($.current=t,t!==me&&(X.current=!1))}),[me]);n.useEffect((()=>{if(null!=me&&_.current){const e=i.findElementByKey(_.current,me,i.ITEM_SELECTOR);if(e){if("card"===ce){const t=e.closest("[role=gridcell]"),r=_.current.getAttribute("aria-activedescendant");t&&r!==t.id&&(_.current.setAttribute("aria-activedescendant",t.id),de.current=!0)}de.current&&!he&&(e.scrollIntoView({block:"nearest"}),de.current=!1)}}}),[me,s,ce,ue,he]);const Re=n.useCallback((e=>{E&&(!1===e.value.all&&e.value.keys.size>0&&(Y.current=Array.from(e.value.keys.values()).pop()),E(e))}),[Y,E]),ve=n.useCallback((e=>{if(s&&E){const t=i.handleSelectionRange(e,s,f);Array.isArray(t)&&("shiftSpace"===e.eventType?Y.current=e.value.start:Y.current=e.value.end,E({value:{all:!1,keys:new Set(t)},target:null}))}}),[s,E,f]),{selectionProps:Ee}=u.useSelection((e=>e===_.current?void 0===me?null:me:i.keyExtractor(e,i.ITEM_SELECTOR)),v,R,!1,"toggle",Re,Y.current,me,((e,t)=>()=>i.getPrevNextKeyByCount(s,f,e,t?-k:k)),((e,t)=>()=>i.getPrevNextKeyByCount(s,f,e,t?-1:1)),(e=>{if(_.current){const t=i.findElementByKey(_.current,e,i.ITEM_SELECTOR);t&&t.scrollIntoView({block:"nearest"})}}),ve),{reorderProps:Ie,reorderItemProps:Te,reorderContext:we,reorderInstructionsId:Ae,reorderInstructions:Ke}=(({currentKey:e,onReorder:t,gutterSize:r,columns:s,rootRef:o,scrollCurrItemIntoView:a})=>{const l=null!=t,[c,d]=n.useState(void 0),{reorderProps:u,reorderContext:y,reorderInstructionsId:m,reorderInstructions:f}=L.useReorderable({onReorder:t,rootRef:o,itemSelector:i.ITEM_SELECTOR,isDisabled:!l,columns:s});return l?{reorderProps:{...u,onDragOver:e=>{i.dragToScroll(e,void 0!==c,o.current),a.current=!1}},reorderItemProps:{currentKey:e,dragKey:c,setDragKey:d,onReorder:t,rootRef:o,gutterSize:r,columns:s},reorderContext:y,reorderInstructionsId:m,reorderInstructions:f}:{reorderProps:u,reorderContext:y,reorderInstructionsId:m,reorderInstructions:f}})({currentKey:me,onReorder:I,gutterSize:j,columns:k,rootRef:_,scrollCurrItemIntoView:de}),Le=ue&&t.jsx(t.Fragment,{children:t.jsx("span",{id:Ae,children:t.jsx(x.HiddenAccessible,{children:Ke})})}),Oe=n.useCallback((()=>{ye.current||(ye.current=!0,y())}),[ye,y]);n.useEffect((()=>{ye.current=!1}),[s,m]);const je=n.useCallback((e=>{const r=f(e.data),s="multiple"===R?()=>t.jsx(g.Selector,{onChange:E,rowKey:r,selectedKeys:v}):void 0;return{index:e.index,data:e.data,metadata:{key:r},selector:s,isSelected:a.containsKey(v,r)}}),[R,v,E,f]),ke=n.useCallback(((e,r)=>{const n=[];if(e){const e={loadingStatus:"initial"};n.push(t.jsx("div",{class:b.LOADMORE_STYLE_CLASS,children:r(e)})),n.push(Q(e,24,r))}else{if(0===k)return null;const e=k-s.length%k,o=e===k,a={loadingStatus:"loadMore",height:"flex"===M||o?ee(D.height):"100%",width:"flex"===M?ee(D.width):"100%"};n.push(t.jsx("div",{class:b.LOADMORE_STYLE_CLASS,children:r(a)})),n.push(Array(Q(a,e-1,r))),o||n.push(Q(a,k,r))}return t.jsx(U,{children:n})}),[D,k,s,M]),Me=s?!s.length&&m?V?ke(!0,V):t.jsx(G,{layout:M}):V?ke(!1,V):t.jsx(W,{layout:M,colCount:k,totalCount:s.length,cardWidth:D.width,cardHeight:D.height}):null;T=i.getViewportConfig(_,T);const De=t.jsx("div",{role:"row",children:t.jsx(N,{...re,children:t.jsx(b.LoadMoreCollection,{data:s,hasMore:m,onLoadMore:Oe,loadMoreIndicator:Me,loadMoreThreshold:te+4,viewportConfig:T,children:r=>{const s=je(r),n=ge(s.metadata.key),o=me===s.metadata.key&&!n,a=o&&Ce,i=s.isSelected;return(r=>t.jsx(z,{context:r,isTabbable:n,isFocused:o,isFocusRingVisible:a,isGridLayout:"grid"===M,isSelected:i,selectionMode:R,focusBehavior:ce,..."content"===w&&{setIsFocusBehaviorValid:le},...se.current&&{initialAnimation:O},...0===s.index&&!D.width&&{updateCardSize:F},...ue&&{reorderItemProps:Te},children:e},s.metadata.key))(s)}})})}),Pe=t.jsx(N,{...re,children:V?q(V):t.jsx(H,{layout:M})});return t.jsxs("div",{...o.mergeProps(be,pe,Ee,Ie,{onFocus:()=>{if(!a.isKeyDefined(me)&&fe&&ge(void 0)&&_.current){const e=$.current||i.getFirstVisibleKey(_.current,i.ITEM_SELECTOR);a.isKeyDefined(e)&&fe({value:e})}else if(a.isKeyDefined(me)&&_.current){const e=i.findElementByKey(_.current,me,i.ITEM_SELECTOR);X.current&&e?.scrollIntoView({block:"nearest"}),X.current=!0}},onPointerDown:Se,onKeyDown:e=>{"content"===ce&&"Tab"===e.key&&_.current?.focus({preventScroll:!0});ue&&(e.metaKey||e.ctrlKey)&&e.shiftKey&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&(de.current=!0)}},{..."card"===ce&&xe}),ref:_,role:"grid",class:C.styles.baseStyle,tabIndex:0,"aria-label":A,"aria-labelledby":K,"aria-describedby":ue?Ae:void 0,"aria-multiselectable":ne,"aria-rowcount":oe,"aria-colcount":ae,children:[t.jsx(h.ReorderableContext.Provider,{value:we,children:s?s.length||m?De:t.jsx(r.Fragment,{}):Pe}),Le]})})),q=e=>t.jsx(U,{children:Q({loadingStatus:"initial"},25,e)}),Q=(e,t,r)=>Array(t).fill(r(e)),ee=e=>`calc(${e}px)`,te=X;e.BaseCardView=te,e.getColCount=(e,t,r)=>{if(!t||!r)return 0;const s=Math.floor((r+e)/(e+t));return Math.max(1,s)},e.gutterSizeToPX=J}));
//# sourceMappingURL=BaseCardView-ab799b69.js.map
