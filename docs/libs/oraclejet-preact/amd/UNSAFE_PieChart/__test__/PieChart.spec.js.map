{"version":3,"file":"PieChart.spec.js","sources":["../../../../src/UNSAFE_PieChart/__test__/PieChart.spec.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { fireEvent, render, screen } from '@testing-library/preact';\nimport { expect } from 'chai';\nimport { PieChart } from '../';\nimport { ComponentProps } from 'preact/compat';\nimport { MenuItem } from '#UNSAFE_Menu';\nimport userEvent from '@testing-library/user-event';\nimport {\n  getAllMenuItemsByRole,\n  getLabel,\n  getMenuItemByRole\n} from '#UNSAFE_Menu/__tests__/menuTestsUtils';\nimport { matchTranslationBundle } from '#utils/UNSAFE_matchTranslationBundle';\nimport { RootEnvironment, RootEnvironmentProvider } from '#UNSAFE_Environment';\nimport { PieChartContextMenuConfig } from '#UNSAFE_PieChart/pieChart.types';\n\nconst pieData = [\n  { id: 1, value: 5 },\n  { id: 2, value: 4 },\n  { id: 3, value: 4 }\n];\n\ndescribe('Test PieChart component', () => {\n  it('render', async function () {\n    render(\n      <PieChart data={pieData} width={'400px'} height={'400px'} aria-label=\"pie chart label\" />\n    );\n    const ariaText = screen.getAllByLabelText('pie chart label');\n    expect(ariaText).not.null;\n\n    const ariaRole = screen.getByRole('application');\n    expect(ariaRole).not.null;\n  });\n  if (typeof jest === 'undefined') {\n    it('trigger context menu on right click', async () => {\n      const config: ComponentProps<typeof PieChart>['contextMenuConfig'] = {\n        // The menu items returned by itemsRenderer must be valid children for the Menu component\n        itemsRenderer: () => {\n          return (\n            <>\n              <MenuItem label={`MenuItem1`}></MenuItem>\n              <MenuItem label={`MenuItem2`}></MenuItem>\n            </>\n          );\n        }\n      };\n      const { container } = await setupPieChart(config);\n\n      const root =\n        // eslint-disable-next-line\n        container.firstElementChild?.firstElementChild?.firstElementChild?.firstElementChild;\n      const firstElement = root as HTMLElement;\n      //We do the necessary to have firstItem as current item\n      fireEvent.contextMenu(firstElement, {\n        clientX: 50,\n        clientY: 50,\n        currentTarget: root\n      });\n      const menu = getMenuItemByRole('menu');\n      const menuItems = getAllMenuItemsByRole('menuitem');\n      //With this we check context menu context was set correctly\n      const menuItemGotByLabel = getLabel('MenuItem1');\n\n      expect(menu).not.null;\n      expect(menuItems.length).equals(2);\n      expect(menuItemGotByLabel).not.null;\n    });\n\n    it('trigger context menu from Keyboard (shift + f10) ', async () => {\n      const config: ComponentProps<typeof PieChart>['contextMenuConfig'] = {\n        // The menu items returned by itemsRenderer must be valid children for the Menu component\n        itemsRenderer: () => {\n          return (\n            <>\n              <MenuItem label={`MenuItem1`}></MenuItem>\n              <MenuItem label={`MenuItem2`}></MenuItem>\n            </>\n          );\n        }\n      };\n\n      const { container } = await setupPieChart(config);\n      // eslint-disable-next-line\n      const root = // eslint-disable-next-line\n        container.firstElementChild?.firstElementChild?.firstElementChild as Element;\n      await userEvent.tab();\n      await userEvent.keyboard('[ENTER]');\n      fireEvent.keyDown(root, { key: 'F10', shiftKey: true });\n      const menu = getMenuItemByRole('menu');\n      const menuItems = getAllMenuItemsByRole('menuitem');\n      //With this we check context menu context was set correctly\n      const menuItemGotByLabel = getLabel('MenuItem1');\n\n      expect(menu).not.null;\n      expect(menuItems.length).equals(2);\n      expect(menuItemGotByLabel).not.null;\n    });\n\n    it('should not trigger context menu when there is no data ', async () => {\n      const config: ComponentProps<typeof PieChart>['contextMenuConfig'] = {\n        // The menu items returned by itemsRenderer must be valid children for the Menu component\n        itemsRenderer: () => {\n          return (\n            <>\n              <MenuItem label={`MenuItem1`}></MenuItem>\n              <MenuItem label={`MenuItem2`}></MenuItem>\n            </>\n          );\n        }\n      };\n\n      const { container } = await setupPieChart(config, []);\n      // eslint-disable-next-line\n      const root = // eslint-disable-next-line\n        container.firstElementChild as Element;\n      await userEvent.tab();\n      await userEvent.keyboard('[ENTER]');\n      fireEvent.keyDown(root, { key: 'F10', shiftKey: true });\n      const menu = screen.queryByRole('menu');\n      expect(menu).null;\n    });\n  }\n});\n\nconst setupPieChart = async (\n  contextMenuConfig?: PieChartContextMenuConfig,\n  data: { id: number; value: number }[] = pieData\n) => {\n  const locale = matchTranslationBundle(['en'], new Set(['en-US', 'en']));\n  const { default: translations } = await import(`../../resources/nls/${locale}/bundle.ts`);\n  const env: Partial<RootEnvironment> = {\n    translations: { '@oracle/oraclejet-preact': translations }\n  };\n  return render(\n    <RootEnvironmentProvider environment={env}>\n      <PieChart\n        contextMenuConfig={contextMenuConfig}\n        data={data}\n        width={'400px'}\n        height={'400px'}\n        aria-label=\"pie chart label\"\n      />\n    </RootEnvironmentProvider>\n  );\n};\n"],"names":["pieData","id","value","describe","it","async","render","_jsx","PieChart","data","width","height","ariaText","screen","getAllByLabelText","expect","not","null","ariaRole","getByRole","jest","config","itemsRenderer","_jsxs","jsxs","_Fragment","Fragment","children","MenuItem","label","container","setupPieChart","root","firstElementChild","firstElement","fireEvent","contextMenu","clientX","clientY","currentTarget","menu","getMenuItemByRole","menuItems","getAllMenuItemsByRole","menuItemGotByLabel","getLabel","length","equals","userEvent","tab","keyboard","keyDown","key","shiftKey","queryByRole","contextMenuConfig","locale","matchTranslationBundle","Set","default","translations","__variableDynamicImportRuntime0__","env","RootEnvironmentProvider","environment"],"mappings":"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"}