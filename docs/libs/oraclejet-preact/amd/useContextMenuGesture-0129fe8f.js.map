{"version":3,"file":"useContextMenuGesture-0129fe8f.js","sources":["../../src/hooks/UNSAFE_useContextMenuGesture/useContextMenuGesture.ts"],"sourcesContent":["import { useCallback, useRef } from 'preact/hooks';\n\nimport { Coords } from '../../UNSAFE_Floating';\n\nimport { getClientHints } from '../../utils/PRIVATE_clientHints';\n\ntype ContextMenuEventDetail = (\n  | { gesture: 'mouse' | 'touch'; anchor: Coords }\n  | { gesture: 'keyboard'; anchor: Element }\n) & { currentTarget: Element; target: Element };\n\ntype ContextMenuHandler = (detail: ContextMenuEventDetail) => void;\n\ntype ContextMenuOptions = {\n  isDisabled?: boolean;\n};\n\n/**\n * `useContextMenuGesture` hook to handle contextMenuGesture. Pure onContextMenu event is not enough to handle this since:\n   1.- onContextMenu event is not supported on mobile safari.\n   2.- onContextMenu can't be triggered using keyboard natively on Mac\n\n   What event is running depends on the gesture:\n   -> Mouse\n      We use native onContextMenu event to support it. Nothing fancy about it, prevent default event to suppress the default browser context menu.\n   -> Keyboard\n      We rely on onKeyDown event, since mac doesn't run onContextMenu when pressing Shift-F10. We preventDefault\n      if Shift-F10 is pressed so onContextMenu native event is not run in platforms that support it.\n   -> Touching \n      This is platform specific.\n      On machines that supports onContextMenu event and also touching (android, hybrid laptops) the native context menu \n      is used.\n      On platforms where onContextMenu doesn't exist(IOS), the steps are the next:\n      1.- We check if only one finger was used and also if the platform is IOS.\n      2.- If there is a touch move we clear the timeout.   \n      3.- If user doesn't move its finger and user holds enough we trigger contextMenu handler.\n      4.- We clearTimeout on touchEnd.\n * \n */\nexport const useContextMenuGesture = (\n  onContextMenuHandler: ContextMenuHandler,\n  contextMenuOptions: ContextMenuOptions = {\n    isDisabled: false\n  }\n): { triggerProps: Record<string, any> } => {\n  /*Use this ref to avoid triggering contextMenuHandler twice. This could happen due to Shift-F10 combination of keys.\n   On firefox preventDefault inside keyDown event does not prevent contextMenu native event to be triggered. That's why \n   we use this ref instead. */\n  const ignoreNativeContextMenuEvent = useRef(false);\n\n  // TODO: We need to confirm if this type is correct or has to be changed. JET-59244\n  const timerId = useRef<ReturnType<typeof setTimeout>>();\n\n  const onContextMenu = useCallback(\n    (event: PointerEvent) => {\n      //Prevent default so we don't open browser context menu\n      event.preventDefault();\n\n      if (ignoreNativeContextMenuEvent.current) {\n        ignoreNativeContextMenuEvent.current = false;\n      } else {\n        onContextMenuHandler({\n          /*Pointer type can be touch/pen/mouse if its touch we passed touch if any other value we consider it a mouse \n            gesture */\n          gesture: event.pointerType === 'touch' ? 'touch' : 'mouse',\n          anchor: {\n            x: event.clientX,\n            y: event.clientY,\n            contextElement: event.currentTarget as Element\n          },\n          currentTarget: event.currentTarget as Element,\n          target: event.target as Element\n        });\n      }\n    },\n    [onContextMenuHandler]\n  );\n\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'F10' && event.shiftKey) {\n        ignoreNativeContextMenuEvent.current = true;\n\n        const currentTarget = event.currentTarget as Element;\n        onContextMenuHandler({\n          gesture: 'keyboard',\n          anchor: currentTarget,\n          currentTarget,\n          target: event.target as Element\n        });\n      }\n    },\n    [onContextMenuHandler]\n  );\n\n  const onTouchStart = useCallback(\n    (event: TouchEvent) => {\n      //We check if the touch was using a single finger and if the platform is ios since there contextMenu event does not exist\n      if (event.touches.length === 1 && getClientHints().platform === 'ios') {\n        const touchobj = event.touches[0];\n        //According to mozilla docs: \"The value of event.currentTarget is only available while the event is being handled\"\n        //Due to this we need to save this element on a const\n        const currentTarget = event.currentTarget as Element;\n\n        timerId.current = setTimeout(() => {\n          onContextMenuHandler({\n            gesture: 'touch',\n            anchor: { x: touchobj.clientX, y: touchobj.clientY, contextElement: currentTarget },\n            currentTarget: currentTarget,\n            target: event.target as Element\n          });\n        }, PRESS_HOLD_TIME);\n      }\n    },\n    [onContextMenuHandler]\n  );\n\n  const onTouchMove = useCallback(() => {\n    clearTimeout(timerId.current);\n  }, []);\n\n  const onTouchEnd = useCallback(() => {\n    clearTimeout(timerId.current);\n  }, []);\n\n  const triggerProps = contextMenuOptions.isDisabled\n    ? {}\n    : { onContextMenu, onKeyDown, onTouchStart, onTouchEnd, onTouchMove };\n\n  return { triggerProps };\n};\n\n//Time needed to hold touch to be considered context menu triggering\nconst PRESS_HOLD_TIME = 750;\n"],"names":["PRESS_HOLD_TIME","onContextMenuHandler","contextMenuOptions","isDisabled","ignoreNativeContextMenuEvent","useRef","timerId","onContextMenu","useCallback","event","preventDefault","current","gesture","pointerType","anchor","x","clientX","y","clientY","contextElement","currentTarget","target","onKeyDown","key","shiftKey","onTouchStart","touches","length","getClientHints","platform","touchobj","setTimeout","onTouchMove","clearTimeout","onTouchEnd","triggerProps"],"mappings":"yFAuCa,MA8FPA,EAAkB,4BA9Fa,CACnCC,EACAC,EAAyC,CACvCC,YAAY,MAMd,MAAMC,EAA+BC,UAAO,GAGtCC,EAAUD,EAAAA,SAEVE,EAAgBC,eACnBC,IAECA,EAAMC,iBAEFN,EAA6BO,QAC/BP,EAA6BO,SAAU,EAEvCV,EAAqB,CAGnBW,QAA+B,UAAtBH,EAAMI,YAA0B,QAAU,QACnDC,OAAQ,CACNC,EAAGN,EAAMO,QACTC,EAAGR,EAAMS,QACTC,eAAgBV,EAAMW,eAExBA,cAAeX,EAAMW,cACrBC,OAAQZ,EAAMY,QAEjB,GAEH,CAACpB,IAGGqB,EAAYd,eACfC,IACC,GAAkB,QAAdA,EAAMc,KAAiBd,EAAMe,SAAU,CACzCpB,EAA6BO,SAAU,EAEvC,MAAMS,EAAgBX,EAAMW,cAC5BnB,EAAqB,CACnBW,QAAS,WACTE,OAAQM,EACRA,gBACAC,OAAQZ,EAAMY,QAEjB,IAEH,CAACpB,IAGGwB,EAAejB,eAClBC,IAEC,GAA6B,IAAzBA,EAAMiB,QAAQC,QAA8C,QAA9BC,mBAAiBC,SAAoB,CACrE,MAAMC,EAAWrB,EAAMiB,QAAQ,GAGzBN,EAAgBX,EAAMW,cAE5Bd,EAAQK,QAAUoB,YAAW,KAC3B9B,EAAqB,CACnBW,QAAS,QACTE,OAAQ,CAAEC,EAAGe,EAASd,QAASC,EAAGa,EAASZ,QAASC,eAAgBC,GACpEA,cAAeA,EACfC,OAAQZ,EAAMY,QACd,GACDrB,EACJ,IAEH,CAACC,IAGG+B,EAAcxB,EAAAA,aAAY,KAC9ByB,aAAa3B,EAAQK,QAAQ,GAC5B,IAEGuB,EAAa1B,EAAAA,aAAY,KAC7ByB,aAAa3B,EAAQK,QAAQ,GAC5B,IAMH,MAAO,CAAEwB,aAJYjC,EAAmBC,WACpC,CAAE,EACF,CAAEI,gBAAee,YAAWG,eAAcS,aAAYF,eAEnC"}