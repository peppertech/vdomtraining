{"version":3,"file":"useChartDrill-253f676b.js","sources":["../../src/hooks/PRIVATE_useChartDrill/useChartDrill.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { Ref, useCallback } from 'preact/hooks';\nimport { getInfo } from '../../utils/UNSAFE_visUtils';\nimport {\n  ChartItemData,\n  ChartGroupInfo,\n  Info,\n  Group,\n  GroupDetail,\n  ItemDetail\n} from '../../utils/UNSAFE_visTypes/chart';\nimport { useVisDrill } from '#hooks/PRIVATE_useVisDrill';\n\ntype DrillEventsProps<K, D> = {\n  rootRef: Ref<HTMLDivElement>;\n  groups: Group[];\n  focusedItemInfo: Info;\n  focusedGroupInfo: ChartGroupInfo;\n  selectionMode: 'none' | 'single' | 'multiple';\n  getDataItem: (seriesIndex: number, groupIndex: number) => D | undefined;\n  drilling: 'on' | 'groupsOnly' | 'off';\n  onItemDrill?: (detail: ItemDetail<K, D>) => void;\n  onGroupDrill?: (detail: GroupDetail) => void;\n};\n\nconst isDrillable = <K, D extends ChartItemData<K>>(\n  info: { seriesIndex?: number; groupIndex?: number },\n  drilling: 'on' | 'groupsOnly' | 'off',\n  groups: Group[],\n  getDataItem: (seriesIndex: number, groupIndex: number) => D | undefined\n) => {\n  const { seriesIndex, groupIndex } = info;\n\n  if (groupIndex === undefined) {\n    return false;\n  }\n\n  if (seriesIndex != null) {\n    const itemDrilling = getDataItem(seriesIndex, groupIndex)?.drilling != 'off';\n    return drilling === 'on' && itemDrilling;\n  } else {\n    return groups[groupIndex].drilling != 'off';\n  }\n};\n\n/**\n * Returns the event handlers for drill support.\n */\nexport function useChartDrill<K, D extends ChartItemData<K>>({\n  rootRef,\n  focusedItemInfo,\n  focusedGroupInfo,\n  groups,\n  selectionMode,\n  drilling,\n  getDataItem,\n  onItemDrill,\n  onGroupDrill\n}: DrillEventsProps<K, D>) {\n  const processDrill = useCallback(\n    (info?: { seriesIndex?: number; groupIndex?: number }) => {\n      if (\n        !info ||\n        info.groupIndex == undefined ||\n        !isDrillable(info, drilling, groups, getDataItem)\n      ) {\n        return;\n      }\n\n      const { seriesIndex, groupIndex } = info;\n\n      if (seriesIndex != null) {\n        const data = getDataItem(seriesIndex, groupIndex);\n        if (data) {\n          onItemDrill?.({\n            groupIndex,\n            seriesIndex,\n            data,\n            id: data?.id\n          });\n        }\n      } else {\n        onGroupDrill?.({\n          groupIndex,\n          group: groups[groupIndex],\n          id: groups[groupIndex].id\n        });\n      }\n    },\n    [drilling, getDataItem, groups, onGroupDrill, onItemDrill]\n  );\n\n  const onDrill = useCallback(\n    (event: Event) => {\n      if (event.type === 'keydown') {\n        const focusedInfo = focusedItemInfo.isCurrent ? focusedItemInfo : focusedGroupInfo;\n        processDrill(focusedInfo);\n      } else {\n        processDrill(getInfo(rootRef, event.target as HTMLElement));\n      }\n    },\n    [rootRef, focusedItemInfo, focusedGroupInfo, processDrill]\n  );\n\n  return useVisDrill(selectionMode, onDrill);\n}\n"],"names":["rootRef","focusedItemInfo","focusedGroupInfo","groups","selectionMode","drilling","getDataItem","onItemDrill","onGroupDrill","processDrill","useCallback","info","undefined","groupIndex","seriesIndex","itemDrilling","isDrillable","data","id","group","onDrill","event","type","focusedInfo","isCurrent","getInfo","target","useVisDrill"],"mappings":"4JAuDM,UAAuDA,QAC3DA,EAAOC,gBACPA,EAAeC,iBACfA,EAAgBC,OAChBA,EAAMC,cACNA,EAAaC,SACbA,EAAQC,YACRA,EAAWC,YACXA,EAAWC,aACXA,IAEA,MAAMC,EAAeC,eAClBC,IACC,IACGA,GACkBC,MAAnBD,EAAKE,aAtCO,EAClBF,EACAN,EACAF,EACAG,KAEA,MAAMQ,YAAEA,EAAWD,WAAEA,GAAeF,EAEpC,QAAmBC,IAAfC,EACF,OAAO,EAGT,GAAmB,MAAfC,EAAqB,CACvB,MAAMC,EAAiE,OAAlDT,EAAYQ,EAAaD,IAAaR,SAC3D,MAAoB,OAAbA,GAAqBU,CAC7B,CACC,MAAsC,OAA/BZ,EAAOU,GAAYR,QAC3B,EAsBMW,CAAYL,EAAMN,EAAUF,EAAQG,GAErC,OAGF,MAAMQ,YAAEA,EAAWD,WAAEA,GAAeF,EAEpC,GAAmB,MAAfG,EAAqB,CACvB,MAAMG,EAAOX,EAAYQ,EAAaD,GAClCI,GACFV,IAAc,CACZM,aACAC,cACAG,OACAC,GAAID,GAAMC,IAGf,MACCV,IAAe,CACbK,aACAM,MAAOhB,EAAOU,GACdK,GAAIf,EAAOU,GAAYK,IAE1B,GAEH,CAACb,EAAUC,EAAaH,EAAQK,EAAcD,IAG1Ca,EAAUV,eACbW,IACC,GAAmB,YAAfA,EAAMC,KAAoB,CAC5B,MAAMC,EAActB,EAAgBuB,UAAYvB,EAAkBC,EAClEO,EAAac,EACd,MACCd,EAAagB,EAAAA,QAAQzB,EAASqB,EAAMK,QACrC,GAEH,CAAC1B,EAASC,EAAiBC,EAAkBO,IAG/C,OAAOkB,EAAWA,YAACvB,EAAegB,EACpC"}