{"version":3,"file":"Layer-276d62e8.js","sources":["../../src/UNSAFE_Layer/Layer.tsx"],"sourcesContent":["import { VNode, RefObject } from 'preact';\nimport { createPortal, useContext, useLayoutEffect, useState, useRef } from 'preact/compat';\nimport { LayerContext, LayerLevel, LayerPriority } from './LayerContext';\nimport { classNames } from '../utils/UNSAFE_classNames';\nimport { baseStyle, styles } from './themes/LayerStyles.css';\nimport { useThemeInterpolations } from '../hooks/UNSAFE_useThemeInterpolations/useThemeInterpolations';\n\nexport const LOGICAL_PARENT = Symbol.for('oj-logical-parent');\n\ntype Props = {\n  /**\n   * The content to be re-parented using Portal\n   */\n  children: VNode;\n  /**\n   * Logical parent of the re-parented content. Typically the 'launcher' associated\n   * with the popup.\n   */\n  logicalParentRef?: RefObject<Element> | null;\n  /**\n   * Determines Layer's stacking context. Components that always need to render on top of other popup\n   * elements (such as Messages) should use respective priority value. The default priority level is 'popup'.\n   */\n  priority?: LayerPriority;\n  /**\n   * Determines Layer's nesting context. By default, new layers will render in the context of a parent Layer,\n   * if it exists (nearestAncestor)). Some popup components (such as Dialog and Message) may need to set up\n   * a new nesting context as(topLevel).\n   */\n  level?: LayerLevel;\n};\n\ntype LayerElement = HTMLDivElement & {\n  [LOGICAL_PARENT]?: Element | null;\n};\n\nconst Layer = ({\n  children,\n  logicalParentRef,\n  priority = 'popup',\n  level = 'nearestAncestor'\n}: Props) => {\n  const context = useContext(LayerContext);\n\n  const [layerContainer, _setLayerContainer] = useState<Element | null>(null);\n  const layerContainerRef = useRef<Element | null>(null);\n\n  const setLayerContainer = (elem: Element | null) => {\n    layerContainerRef.current = elem;\n    _setLayerContainer(elem);\n  };\n\n  // because the children are being rendered into a portal that is out of the flow of parent dom,\n  // we need to specify the colorScheme and scale class names here to pick up the correct CSS styles.\n  const themeClasses = useThemeInterpolations();\n\n  let priorityStyle = styles.popupPriorityStyle;\n\n  switch (priority) {\n    case 'dialog': {\n      priorityStyle = styles.dialogPriorityStyle;\n      break;\n    }\n    case 'messages': {\n      priorityStyle = styles.messagesPriorityStyle;\n      break;\n    }\n    default: {\n      priorityStyle = styles.popupPriorityStyle;\n      break;\n    }\n  }\n\n  const classes = classNames([themeClasses, baseStyle, priorityStyle]);\n\n  // Really need useLayoutEffect instead of useEffect here. Otherwise the re-parented\n  // content does not get re-rendered with valid ref's\n  useLayoutEffect(() => {\n    const host =\n      level === 'topLevel'\n        ? context.getRootLayerHost?.(priority)\n        : context.getLayerHost?.(priority);\n\n    if (!host) return;\n    const doc = host.ownerDocument ?? document;\n    const layer: LayerElement = doc.createElement('div');\n\n    layer.setAttribute('data-oj-layer', 'true');\n\n    if (logicalParentRef) {\n      layer[LOGICAL_PARENT] = logicalParentRef.current;\n    }\n    // layer.style.position = 'relative';\n    host.appendChild(layer);\n    setLayerContainer(layer);\n\n    return () => {\n      if (host && layer && host.contains(layer)) {\n        delete layer[LOGICAL_PARENT];\n        host.removeChild(layer);\n      }\n      if (context.onLayerUnmount) {\n        context.onLayerUnmount(layer);\n      }\n      setLayerContainer(null);\n    };\n  }, [logicalParentRef, context, level, priority]);\n\n  // add the colorScheme and scale classes if there is a layerContainer\n  if (layerContainer) {\n    // use the theme interpolations to set the appropriate style classes for colorScheme and scale\n    layerContainer.className = classes;\n  }\n\n  const getLayerHost = () => {\n    return layerContainer;\n  };\n\n  let newLayerContext = {};\n\n  if (context.getLayerHost) {\n    newLayerContext = {\n      getRootLayerHost: context.getRootLayerHost?.bind(null, priority),\n      getLayerHost: getLayerHost.bind(null)\n    };\n  }\n\n  return (\n    <LayerContext.Provider value={newLayerContext}>\n      {layerContainer && createPortal(children, layerContainer)}\n    </LayerContext.Provider>\n  );\n};\n\nexport default Layer;\n"],"names":["LOGICAL_PARENT","Symbol","for","children","logicalParentRef","priority","level","context","useContext","LayerContext","layerContainer","_setLayerContainer","useState","layerContainerRef","useRef","setLayerContainer","elem","current","themeClasses","useThemeInterpolations","priorityStyle","styles","popupPriorityStyle","dialogPriorityStyle","messagesPriorityStyle","classes","classNames","baseStyle","useLayoutEffect","host","getRootLayerHost","getLayerHost","layer","ownerDocument","document","createElement","setAttribute","appendChild","contains","removeChild","onLayerUnmount","className","newLayerContext","bind","_jsx","Provider","value","createPortal"],"mappings":"yNAOa,MAAAA,EAAiBC,OAAOC,IAAI,gDA6B3B,EACZC,WACAC,mBACAC,WAAW,QACXC,QAAQ,sBAER,MAAMC,EAAUC,aAAWC,EAAAA,eAEpBC,EAAgBC,GAAsBC,EAAQA,SAAiB,MAChEC,EAAoBC,SAAuB,MAE3CC,EAAqBC,IACzBH,EAAkBI,QAAUD,EAC5BL,EAAmBK,EAAK,EAKpBE,EAAeC,EAAAA,yBAErB,IAAIC,EAAgBC,EAAMA,OAACC,mBAE3B,OAAQjB,GACN,IAAK,SACHe,EAAgBC,EAAMA,OAACE,oBACvB,MAEF,IAAK,WACHH,EAAgBC,EAAMA,OAACG,sBACvB,MAEF,QACEJ,EAAgBC,EAAMA,OAACC,mBAK3B,MAAMG,EAAUC,EAAAA,WAAW,CAACR,EAAcS,EAASA,UAAEP,IAIrDQ,EAAAA,iBAAgB,KACd,MAAMC,EACM,aAAVvB,EACIC,EAAQuB,mBAAmBzB,GAC3BE,EAAQwB,eAAe1B,GAE7B,IAAKwB,EAAM,OACX,MACMG,GADMH,EAAKI,eAAiBC,UACFC,cAAc,OAW9C,OATAH,EAAMI,aAAa,gBAAiB,QAEhChC,IACF4B,EAAMhC,GAAkBI,EAAiBa,SAG3CY,EAAKQ,YAAYL,GACjBjB,EAAkBiB,GAEX,KACDH,GAAQG,GAASH,EAAKS,SAASN,YAC1BA,EAAMhC,GACb6B,EAAKU,YAAYP,IAEfzB,EAAQiC,gBACVjC,EAAQiC,eAAeR,GAEzBjB,EAAkB,KAAK,CACxB,GACA,CAACX,EAAkBG,EAASD,EAAOD,IAGlCK,IAEFA,EAAe+B,UAAYhB,GAG7B,MAAMM,EAAe,IACZrB,EAGT,IAAIgC,EAAkB,CAAA,EAStB,OAPInC,EAAQwB,eACVW,EAAkB,CAChBZ,iBAAkBvB,EAAQuB,kBAAkBa,KAAK,KAAMtC,GACvD0B,aAAcA,EAAaY,KAAK,QAKlCC,MAACnC,EAAYA,aAACoC,SAAS,CAAAC,MAAOJ,EAAevC,SAC1CO,GAAkBqC,EAAAA,aAAa5C,EAAUO,IAE5C"}