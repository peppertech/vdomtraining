define(['exports', 'preact/jsx-runtime', './useResizeObserver-b70bb2bf', 'preact/hooks', './classNames-2e65b3b3', './UNSAFE_Diagram/themes/DiagramStyles.css', './useTranslationBundle-d999fb18', './useUser-e0989b0b', './LayoutUtils-75d8cff4', './useDatatip-88cbd577', './util-aa688832', './useTextDimensions-a2b7ad1c', './mergeProps-7d608009', './useSelection-0c4c6e5c', './size-a13c8931', './TrackResizeContainer-ff49e9cb'], (function(e,t,n,o,r,i,s,a,d,c,u,l,f,h,g,p){"use strict";const m=20;function x(e){const t=new Map,n=new Map,o=new Map;for(let r=0;r<e.length;r++)t.set(e[r].id,e[r]),n.set(e[r].id,r),o.set(r,e[r].id);return{itemIdToDataMap:t,itemIdToIndexMap:n,itemIndexToIdMap:o}}function y(e,t){const n=[];if(e)for(let t=0;t<e.length;t++)n.push(e[t]);if(t)for(let e=0;e<t.length;e++)n.push(t[e]);return n}function b(e,t,n){const o=v(t,e,n);if(e.rotationAngle){const n=e.rotationPoint?e.rotationPoint:{x:t.width/2,y:t.height/2},r=e.rotationAngle,i=w({x:0,y:0},n),s=w({x:t.width,y:0},n),a=w({x:0,y:t.height},n),d=w({x:t.width,y:t.height},n);return function(e){let t=e[0].x,n=e[0].y,o=e[0].x,r=e[0].y;for(let i=1;i<e.length;i++){const s=e[i];s.x<t?t=s.x:s.x>o&&(o=s.x),s.y<n?n=s.y:s.y>r&&(r=s.y)}return{x:t,y:n,w:o-t,h:r-n}}([I(i,r),I(a,r),I(s,r),I(d,r)].map((e=>({x:e.x+o.x+n.x,y:e.y+o.y+n.y}))))}return{x:o.x,y:o.y,w:t.width,h:t.height}}function w(e,t){return{x:e.x-t.x,y:e.y-t.y}}function I(e,t){return{x:e.x*Math.cos(t)-e.y*Math.sin(t),y:e.x*Math.sin(t)+e.y*Math.cos(t)}}function v(e,t,n){const o=t.position,r=t.hAlign?t.hAlign:n?"right":"left",i=t.vAlign;let s,a;return s="center"===r?o.x-e.width/2:"right"===r?o.x-e.width:o.x,a="middle"===i?o.y-e.height/2:"bottom"===i?o.y-e.height:"baseline"===i?o.y+e.y:o.y,{x:s,y:a}}function P(e,t,n,o,r){return{panX:o/2-e*n,panY:r/2-t*n}}function S(e,t){return e?.id===t?.id&&e?.isNode===t?.isNode}function M(e,t){let n,o=!1,r=e;for(;!n;)if(n=r.dataset.node,n?o=!0:n=r.dataset.link,!n){if(!r.parentElement||r.parentElement===t?.current)break;r=r.parentElement}return{id:n,isNode:o}}function N(e,t,n,o){return e.dataVisualization_stateSelected(),t?`${o}. ${n?e.dataVisualization_stateSelected():e.dataVisualization_stateUnselected()}`:o}function z(e,t,n){const o=(e-2*m)/n.w,r=(t-2*m)/n.h;return Math.min(o,r)}function k(e,t,n){let o=Math.max(t,e);return o=Math.min(n,o),o}function D(e){const t={};return e?(e.fontFamily&&(t.fontFamily=e.fontFamily),e.fontSize&&(t.fontSize=e.fontSize),e.fontStyle&&(t.fontStyle=e.fontStyle),e.fontWeight&&(t.fontWeight=e.fontWeight),t):t}function R(e,t,n,o,r,i,s){let a;if(e.isNode){a=n[o.get(e.id)]}else{const r=t.get(e.id),i=n[o.get(r.startNode)],s=n[o.get(r.endNode)],d=Math.min(i.x,s.x),c=Math.min(i.y,s.y);a={x:d,y:c,w:Math.max(i.x+i.w,s.x+i.w)-d,h:Math.max(i.y+i.h,s.y+s.h)-c}}return function(e,t,n,o){const r=(n-2*m)/e.w,i=(o-2*m)/e.h,s=Math.min(r,i,t),a=e.w/2+e.x,d=e.h/2+e.y;return{centerX:a,centerY:d,zoom:s}}(a,s,r,i)}const X=({id:e,state:a,previousState:d,position:c,activeId:u,nodeRenderer:l,onNodeSizeChanged:f,nodeIndex:h,data:g,accessibleLabel:p,isDimmed:m,supportsSelection:x})=>{const{nodeStyles:y,dimmedItemStyle:b}=i.itemStyles,w={state:a,previousState:d,data:g},I=s.useTranslationBundle("@oracle/oraclejet-preact"),v=o.useRef(null),P=o.useRef({box:"border-box"});return n.useResizeObserver({ref:v,callback:o.useCallback((e=>{const t=e.borderBoxSize,n=t[0].inlineSize,o=t[0].blockSize;f(n,o,h)}),[h,f]),resizeObserverOptions:P.current}),t.jsx("div",{ref:v,class:r.classNames([y,m?b:void 0]),"data-node":e,role:"img","aria-label":N(I,x,a.selected,p),style:{top:c.y,left:c.x},id:a.focused||a.hovered?u:void 0,children:l(w)},e)};function Y({nodes:e,states:n,previousStates:o,nodeRenderer:r,nodeBounds:s,onNodeSizeChanged:a,supportsSelection:d}){return t.jsx("div",{class:i.layerStyles,children:e.map(((e,i)=>{const c=s&&s[i]?{x:s[i].x,y:s[i].y}:{x:0,y:0},u={selected:n.selectedNodeIds.includes(e.id),focused:n.focusedId===e.id,hovered:n.hoveredId===e.id,zoom:n.zoom},l={selected:o.selectedNodeIds.includes(e.id),focused:o.focusedId===e.id,hovered:o.hoveredId===e.id,zoom:o.zoom};return t.jsx(X,{id:e.id,position:c,state:u,previousState:l,isDimmed:0!==n.highlightedIds.length&&!n.highlightedIds.includes(e.id),activeId:n.activeId,nodeRenderer:r,onNodeSizeChanged:a,nodeIndex:i,accessibleLabel:e.accessibleLabel,data:e,supportsSelection:d})}))})}const T=({id:e,state:n,previousState:o,activeId:a,data:d,linkRenderer:c,accessibleLabel:u,isDimmed:l,supportsSelection:f})=>{const h=s.useTranslationBundle("@oracle/oraclejet-preact"),{dimmedItemStyle:g,linkStyles:p}=i.itemStyles,m={state:n,previousState:o,data:d};return t.jsx("g",{id:n.focused?a:void 0,"aria-label":N(h,f,n.selected,u),"data-link":e,role:"img",class:r.classNames([p,l&&g]),children:c(m)},e)};function C({links:e,states:n,previousStates:o,linkRenderer:r,width:s,height:a,supportsSelection:d}){return t.jsx("svg",{class:i.layerStyles,width:s,height:a,children:e.map((e=>{const i={selected:n.selectedLinkIds.includes(e.id),focused:n.focusedId===e.id,hovered:n.hoveredId===e.id,zoom:n.zoom},s={selected:o.selectedLinkIds.includes(e.id),focused:o.focusedId===e.id,hovered:o.hoveredId===e.id,zoom:o.zoom};return t.jsx(T,{id:e.id,label:e.label,state:i,previousState:s,isDimmed:0!==n.highlightedIds.length&&!n.highlightedIds.includes(e.id),activeId:n.activeId,accessibleLabel:e.accessibleLabel,data:e,linkRenderer:r,supportsSelection:d})}))})}const L=({text:e,position:n,styles:o,dimensions:s,isRTL:a})=>{const{labelStyle:d,labelBorderStyle:c}=i.labelStyles,u=v(s,n,a),l=function(e){const t=e.rotationAngle,n=e.rotationPoint,o={};t&&(o.transform=`rotate(${t}deg)`);n&&(o["transform-origin"]=`${n.x}px ${n.y}px`);return o}(n);return t.jsx("div",{class:r.classNames([d,o&&o.borderColor&&c]),style:{top:u.y,left:u.x,...o,...l},children:e})};function Z({labelPosition:e,itemProps:n,labelDimensions:o}){const{direction:r}=a.useUser();return t.jsx("div",{class:i.layerStyles,children:n.map(((n,i)=>{if(n.label&&e[i])return t.jsx(L,{styles:n.labelStyle,text:n.label,position:e[i],dimensions:o.get(n.id),isRTL:"rtl"===r})}))})}function A({nodes:e,links:n,nodeRenderer:o,linkRenderer:r,states:i,previousStates:s,nodeBounds:a,onNodeSizeChanged:d,width:c,height:u,nodeLabelPositions:l,linkLabelPositions:f,labelDimensions:h,supportsSelection:g}){return t.jsxs(t.Fragment,{children:[n.length>0&&r&&c!==1/0&&t.jsx(C,{links:n,states:i,previousStates:s,linkRenderer:r,width:c,height:u,supportsSelection:g}),t.jsx(Y,{nodes:e,nodeBounds:a,states:i,previousStates:s,nodeRenderer:o,onNodeSizeChanged:d,supportsSelection:g}),h?t.jsxs("div",{children:[l?t.jsx(Z,{labelPosition:l,itemProps:e,labelDimensions:h}):void 0,n&&f?t.jsx(Z,{labelPosition:f,itemProps:n,labelDimensions:h}):void 0]}):void 0]})}function V({centerX:e,centerY:n,children:o,zoom:r,width:s,height:a}){const d=P(e,n,r,s,a);return t.jsx("div",{class:i.panZoomStyles,style:{translate:`${d.panX}px ${d.panY}px`,transform:`scale(${r})`},children:o})}function E(e,t){let n;for(let o=0;o<t.length;o++)if(n=t[o],e.id===n.id)return n}function O(e,t){const n=[];return t.forEach((t=>{const o=t.startNode,r=t.endNode;o!=e&&r!=e||n.push(t)})),n}function j(e,t,n,o){let r,i=n[0],s=n[0];for(let e=0;e<n.length;e++)r=n[e],r.id===t.startNode?i=r:r.id===t.endNode&&(s=r);const a=e.id==i.id?s:i,d=K(e,o),c=K(a,o);let u=Math.atan2(c.y-d.y,c.x-d.x);return u=u<0?u+2*Math.PI:u,u}function B(e,t,n){let o,r=t[0],i=t[0];for(let n=0;n<t.length;n++)o=t[n],o.id===e.startNode?r=o:o.id===e.endNode&&(i=o);const s=K(r,n),a=K(i,n);return Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2))}function F(e,t){return t.endNode===e.id?1:0}function K(e,t){const n=t.get(e.id);return{x:n.x+n.w/2,y:n.y+n.h/2}}function U(e,t,n){const o=15/180*Math.PI,r=40/180*Math.PI,i=e.x+e.w/2,s=e.y+e.h/2,a=t.x+t.w/2,d=t.y+t.h/2,c=Math.abs(i-a),u=Math.abs(s-d),l=Math.atan2(u,c);let f=Math.sqrt(c*c+u*u);return(l>o&&("right"==n||"left"==n)||l<Math.PI/2-o&&("up"==n||"down"==n))&&(l>r&&("right"==n||"left"==n)||l<Math.PI/2-r&&("up"==n||"down"==n)?f*=6:f*=2),f}function _(e,t,n,o){if(o){const o=e.x+.5*e.w,r=t.x+.5*t.w,i=e.y+.5*e.h,s=t.y+.5*t.h;switch(n){case"up":return i<s;case"down":return e.y>s;case"right":return o>r;case"left":return o<r}return!0}switch(n){case"up":return e.y<t.y||q(e.y,t.y);case"down":return e.y>t.y||q(e.y,t.y);case"right":return e.x>t.x||q(e.x,t.x);case"left":return e.x<t.x||q(e.x,t.x)}return!0}function G(e,t,n){switch(n){case"up":return $(e,t)&&(t.y<=e.y+e.h||q(t.y,e.y+e.h));case"down":return $(e,t)&&(e.y<=t.y+t.h||q(e.y,t.y+t.h));case"right":return W(e,t)&&(e.x<=t.x+t.w||q(e.x,t.x+t.w));case"left":return W(e,t)&&(t.x<=e.x+e.w||q(t.x,e.x+e.w))}return!1}function $(e,t){return e.x>=t.x&&e.x<=t.x+t.w||t.x>=e.x&&t.x<=e.x+e.w}function W(e,t){return e.y>=t.y&&e.y<=t.y+t.h||t.y>=e.y&&t.y<=e.y+e.h}function q(e,t){return Math.abs(e-t)<=1e-7}function J(e,t){let n=Math.abs(e-t)<=1e-7;return n||(n=Math.abs(2*Math.PI+Math.min(e,t)-Math.max(e,t))<=1e-7),n}function H(e,t,n,r){const i=o.useRef(),s=function(e,t){const n=new Map;for(let o=0;o<e.length;o++)n.set(e[o].id,t[o]);return n}(e,n);return{isNode:n=>{let o,r;for(let i=0;i<e.length;i++){if(o=e[i],r=t[i],n.id===o.id)return!0;if(n.id===r.id)return!0}return!1},getNextNavigableNode:function(e,t,n,o){if(!o)return n;if(!n)return o[0];const r=s.get(n.id);if(!r)return o[0];let i,a,d,c=n,u=Number.MAX_VALUE,l=!1,f=!1;for(let h=0;h<o.length;h++){if(i=o[h],i===n){f=!0;continue}const g=s.get(i.id);if(!g)continue;const p={x:g.x,y:g.y,w:g.w,h:g.h},m={x:r.x,y:r.y,w:r.w,h:r.h};_(p,m,e,t)&&(a=G(p,m,e),l&&!a||(d=U(p,m,e),(0!=d||f)&&(!l&&a||d<u&&(l&&a||!l))&&(u=d,c=i,l=a)))}return c},getNextNavigableLink:function(e,t,n,o){if(!o)return n;if(!n)return o[0];const r=i.current,a=E({id:r||n.startNode,isNode:!0},t);if(!a)return n;const d=function(e,t,n,o){let r,i,s;const a=[];for(let d=0;d<t.length;d++){const c=t[d];r=j(e,c,n,o),i=B(c,n,o),s=F(e,c),a.push({id:c.id,angle:r,distance:i,direction:s})}return a}(a,o=O(a.id,o),t,s);d.sort(((e,t)=>{const{angle:n,distance:o,direction:r}=e,{angle:i,distance:s,direction:a}=t;let d=-1;return!J(n,i)&&n>i?d=1:J(n,i)&&(o>s||s==o&&r>a?d=1:s==o&&r==a&&(d=0)),d}));const c="down"==e;let u=0;for(let e=0;e<d.length;e++){if(d[e].id===n.id){u=c?e==d.length-1?0:e+1:0==e?d.length-1:e-1;break}}return d[u]},navigateFromNodeToLink:function(e,t,n){if(!n)return;const o=O(n.id,e);if(o.length<1)return;let r=o[0];const a=s.get(n.id);let d,c,u,l;const f=a.x+a.w/2;i.current=n.id;for(let e=0;e<o.length;e++)if(d=o[e],c=d.startNode===n.id?d.endNode:d.startNode,u=s.get(c),l=u.x+u.w/2,t.altKey&&"Comma"===t.code&&l<=f||t.altKey&&"Period"===t.code&&l>=f){r=d;break}return{id:r.id,isNode:!1}},navigateFromLinkToNode:function(e,t){const n=t.key,o=r.get(e),i=s.get(o.startNode),a=s.get(o.endNode);if(!i||!a)return;const d=i.x+i.w/2,c=a.x+a.w/2;return{id:c>d&&"ArrowRight"===n||c<d&&"ArrowLeft"===n?o.endNode:o.startNode,isNode:!0}}}}const Q=15,ee=.15;function te(e,t,n,r,i,s,a,c,u,l,f,h){const{getNextNavigableNode:g,getNextNavigableLink:p,navigateFromNodeToLink:m,navigateFromLinkToNode:x}=H(t,n,r,i),[y,b]=o.useState({id:e.id,isNode:!0}),[w,I]=o.useState(),v=o.useRef();function P(e){l?.({id:e.id,type:e.isNode?"node":"link"}),v.current=d.getRandomId(),b(e)}function N(e){e&&(S(e,y)||(e.isCurrent=!0,e.isFocusVisible=!0,w&&I({...w,isCurrent:!1}),P(e)))}return{focusedItemInfo:y,hoveredItemInfo:w,"aria-activedescendant":v.current,onKeyUp:e=>{if("Tab"===e.code)P({...y,isCurrent:!0,isFocusVisible:!0})},onKeyDown:e=>{const o=e.key;let d=!1;if("TAB"!==o){if(function(e){const t=e.code;if(y.isNode&&e.altKey&&("Period"===t||"Comma"===t))return!0;if(!y.isNode&&("ArrowLeft"===t||"ArrowRight"===t))return!0;return!1}(e)){N(y.isNode?m(n,e,E(y,t)):x(y.id,e)),d=!0}else if(function(e){switch(e){case"ArrowDown":case"ArrowUp":case"ArrowRight":case"ArrowLeft":return!0}return!1}(o)){const e=function(e){let o="down";switch(e){case"ArrowDown":o="down";break;case"ArrowUp":o="up";break;case"ArrowRight":o="right";break;case"ArrowLeft":o="left"}if(y.isNode){const e=g(o,!0,E(y,t),t);return e?{id:e.id,isNode:!0}:y}{const e=function(e,t){let n;for(let o=0;o<t.length;o++)if(n=t[o],e.id===n.id)return n}(y,n),r=p(o,t,e,n);return r?{id:r.id}:{id:y.id}}}(o);N(e),d=!0}else switch(o){case"PageUp":f&&f({dPan:{dx:e.shiftKey?-Q:0,dy:e.shiftKey?0:-Q}}),d=!0;break;case"PageDown":f&&f({dPan:{dx:e.shiftKey?Q:0,dy:e.shiftKey?0:Q}}),d=!0,d=!0;break;case"+":case"=":h&&h({dZoom:ee}),d=!0;break;case"-":case"_":h&&h({dZoom:-ee}),d=!0;break;case"0":if(e.ctrlKey&&e.altKey){const{centerX:e,centerY:t,zoom:n}=R(y,i,r,s,a,c,u);h&&h({nZoom:n}),f&&f({nPan:{cx:e,cy:t}})}else h&&h({}),f&&f({center:!0});d=!0}d&&(e=>{e.preventDefault(),e.stopPropagation()})(e)}},onBlur:()=>{(null!=w||y.isCurrent)&&l?.({id:void 0});const e={...y,isCurrent:!1,isFocusVisible:!1};b(e)},onPointerUp:e=>{const t=M(e.target);null!=t.id&&(b(t),v.current=d.getRandomId())},onPointerMove:e=>{const t=M(e.target);t&&!S(t,w)&&(I({...t,isCurrent:!0}),v.current=d.getRandomId(),b({...y,isCurrent:!1}),l?.({id:t.id,type:t.isNode?"node":"link"}))},onPointerLeave:()=>{I(void 0),v.current=void 0,l?.({id:void 0})}}}const ne=({captureTargetRef:e,numPointers:t=1,onPointerGestureDown:n,onPointerGestureMove:r,onPointerGestureEnd:i,onExtraneousPointerDown:s,isDisabled:a=!1})=>{const d=o.useRef([]);a&&(d.current=[]);const c=e=>{const n=d.current.findIndex((t=>t.pointerId===e.pointerId));-1!==n&&(d.current[n]=e,d.current.length===t&&i&&i({pointers:d.current}),d.current.splice(n,1))};return a?{}:{onPointerDown:e=>{d.current.push(e),d.current.length===t?n&&n({pointers:d.current}):d.current.length>t&&s&&s({pointers:d.current})},onPointerMove:n=>{if(0===d.current.length)return;const o=d.current.findIndex((e=>e.pointerId===n.pointerId));-1!==o&&(d.current[o]=n,d.current.length===t&&(d.current.forEach((t=>e.current.setPointerCapture(t.pointerId))),r&&r({pointers:d.current})))},onPointerUp:c,onPointerCancel:c,onPointerLeave:c}},oe=(e,t,n,o,r,i,s,a)=>{if(!s)return{newPan:{panX:0,panY:0}};const d=((e,t,n,o)=>{const r="y"!==o?t.panX:e.panX,i="x"!==o?t.panY:e.panY;return{panX:r>n.maxX||r<n.minX?e.panX:r,panY:i>n.maxY||i<n.minY?e.panY:i}})(e,t,s,n),c=d.panX!==e.panX||d.panY!==e.panY,u=function(e,t,n,o,r){return{centerX:(o/2-e)/n,centerY:(r/2-t)/n}}(d.panX,d.panY,o,r,i);return c&&a&&a({centerX:u.centerX,centerY:u.centerY}),{newPan:d}},re=({panProps:e,captureTargetRef:t,panBounds:n,width:r,height:i,zoom:s,onDragPanStart:a,onDragPanEnd:d})=>{const c=o.useRef({panX:0,panY:0}),u=o.useRef({panX:0,panY:0}),l=(({captureTargetRef:e,draggableRegion:t,onDragStart:n,onDragMove:r,onDragEnd:i,isDisabled:s=!1})=>{const a={isDragging:!1,x0:-1,y0:-1,regionOffsetX:-1,regionOffsetY:-1},d=o.useRef(a),c=(e,t)=>{const{isDragging:n,x0:o,y0:r,regionOffsetX:i,regionOffsetY:s}=d.current;if(!n)return;const a=e.pageX,c=e.pageY;t&&t({x:a,y:c,dx:a-o,dy:c-r,regionOffsetX:i,regionOffsetY:s,originalEvent:e})},u=ne({captureTargetRef:e,numPointers:1,onExtraneousPointerDown:()=>{d.current=a},onPointerGestureDown:({pointers:[e]})=>{const o=e.pageX,r=e.pageY;if(0!==e.button||!((e,t,n)=>{if(!n)return!0;const{xMin:o,xMax:r,yMin:i,yMax:s}=n;return e>=o&&e<=r&&t>=i&&t<=s})(o,r,t))return;const{regionOffsetX:i,regionOffsetY:s}=((e,t,n)=>n?{regionOffsetX:e-n.xMin,regionOffsetY:t-n.yMin}:{regionOffsetX:e,regionOffsetY:t})(o,r,t);d.current={isDragging:!0,x0:o,y0:r,regionOffsetX:i,regionOffsetY:s},n&&n({x:o,y:r,regionOffsetX:i,regionOffsetY:s,originalEvent:e})},onPointerGestureMove:({pointers:[e]})=>{c(e,r)},onPointerGestureEnd:({pointers:[e]})=>{c(e,i),d.current=a}});return s?{}:u})({captureTargetRef:t,onDragStart:()=>{const t=P(e.centerX,e.centerY,s,r,i);u.current={panX:t.panX,panY:t.panY},a&&a()},onDragMove:({dx:t,dy:o})=>{const a={panX:u.current.panX+t,panY:u.current.panY+o},{newPan:d}=oe(c.current,a,e.panDirection,s,r,i,n,e.onPan);c.current=d},onDragEnd:({originalEvent:e})=>{u.current.panX===c.current.panX&&u.current.panY===c.current.panY||e.preventDefault(),d&&d()},isDisabled:"off"===e.panning});return l},ie=(e,t,n,o,r)=>{const i=e>o||e<n?t:e;i!==t&&r&&r({zoomValue:i})},se=(e,t)=>Math.sqrt((t.x-e.x)**2+(t.y-t.y)**2),ae=({captureTargetRef:e,zooming:t,minZoom:n,maxZoom:r,zoomValue:i,onZoom:s})=>{const a=(({captureTargetRef:e,onPinchZoomStart:t,onPinchZoomChange:n,onPinchZoomEnd:r,isDisabled:i=!1})=>{const s=o.useRef({x:-1,y:-1}),a=o.useRef(-1),d=()=>{s.current={x:-1,y:-1},a.current=-1};i&&d();const c=ne({captureTargetRef:e,numPointers:2,onPointerGestureDown:({pointers:[e,n]})=>{const o={x:e.offsetX,y:e.offsetY},r={x:n.offsetX,y:n.offsetY};s.current=((e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2}))(o,r),a.current=se(o,r),t&&t({origin:s.current,delta:0})},onPointerGestureMove:({pointers:[e,t]})=>{const o={x:e.offsetX,y:e.offsetY},r={x:t.offsetX,y:t.offsetY},i=se(o,r),d=i-a.current;a.current=i,n&&n({origin:s.current,delta:d})},onPointerGestureEnd:()=>{d(),r&&r()}});return i?{}:c})({captureTargetRef:e,onPinchZoomChange:({delta:e})=>{ie(i*(1+.05*e),i,n,r,s)},isDisabled:"off"===t});return a},de=({props:e,captureTargetRef:t,width:n,height:r,contentBounds:i})=>{const[s,a]=o.useState(),d=function(e,t,n,o){const r=e.minZoom?e.minZoom:z(t,n,o),i=void 0!==e.maxZoom?e.maxZoom:1,s=e.zoomValue?e.zoomValue:z(t,n,o);return{zooming:e.zooming?e.zooming:"off",minZoom:r,maxZoom:i,zoomValue:k(s,r,i),onZoom:e.onZoom}}(e,n,r,i),c=function(e,t){return{panning:e.panning?e.panning:"off",panDirection:e.panDirection?e.panDirection:"any",centerX:void 0!==e.centerX?e.centerX:t.w/2+t.x,centerY:void 0!==e.centerY?e.centerY:t.h/2+t.y,onPan:e.onPan}}(e,i),u=o.useRef(),l=o.useRef(),h=o.useRef(),g=o.useRef({zoom:e.zoomValue||0,centerX:e.centerX,centerY:e.centerY});i.w===1/0||d.zoomValue===l.current&&c.panning===h.current||(u.current=((e,t,n,o,r,i,s)=>{const{x:a,y:d,w:c,h:u}=n;let l,f,h,g;if("centerContent"===o)l=e/2-(c+a)*r,h=t/2-(u+d)*r,f=e/2-a*r,g=t/2-d*r;else{const n=r/i,o=(e-c*i)/2-a*i,s=(t-u*i)/2-d*i;l=e-e*n+o*n,h=t-t*n+s*n,f=o*n,g=s*n}const p=s.zoom,m=s.centerX,x=s.centerY;let y,b;if(m){const t=m*p-e/2;-t*p<l?(y=l-t*p,l-=y,f+=y):-t*p>f&&(y=-t*p-f,l-=y,f+=y)}if(x){const e=x*p-t/2;-e*p<h?(b=h-e*p,h-=b,g+=b):-e*p>g&&(b=-e*p-g,h-=b,g+=b)}return{minX:l,maxX:f,minY:h,maxY:g}})(n,r,i,c.panning,d.zoomValue,d.minZoom,g.current),l.current=d.zoomValue,h.current=c.panning);const p=re({panProps:c,captureTargetRef:t,panBounds:u.current,zoom:d.zoomValue,width:n,height:r,onDragPanStart:()=>a("grabbing"),onDragPanEnd:()=>a("auto")}),m=o.useRef({panX:0,panY:0}),x=(({zooming:e,minZoom:t,maxZoom:n,zoomValue:o,onZoom:r})=>(({onWheel:e,preventDefault:t=!0,isDisabled:n=!1})=>n?{}:{onWheel:n=>{const{deltaX:o,deltaY:r}=(e=>{const{deltaX:t,deltaY:n,deltaMode:o}=e;switch(o){case e.DOM_DELTA_PIXEL:return{deltaX:-t,deltaY:-n};case e.DOM_DELTA_LINE:return{deltaX:15*-t,deltaY:15*-n};case e.DOM_DELTA_PAGE:return{deltaX:40*-t,deltaY:40*-n};default:return{deltaX:-t,deltaY:-n}}})(n);t&&n.preventDefault(),e({x:n.offsetX,y:n.offsetY,deltaX:o,deltaY:r,ctrlKey:n.ctrlKey||n.metaKey})}})({onWheel:({deltaY:e})=>{ie(o*(1+.05*e),o,t,n,r)},isDisabled:"off"===e}))(d),y=ae({captureTargetRef:t,zooming:d.zooming,minZoom:d.minZoom,maxZoom:d.maxZoom,zoomValue:d.zoomValue,onZoom:d.onZoom});return{panZoomProps:f.mergeProps(p,x,y),cursor:s,centerX:c.centerX,centerY:c.centerY,zoomValue:d.zoomValue,kbPanCallback:"off"!==c.panning?e=>{let t,o;e.center?(t=i.x+i.w/2,o=i.y+i.h/2):e.dPan?(t=c.centerX+e.dPan.dx,o=c.centerY+e.dPan.dy):(t=e.nPan.cx,o=e.nPan.cy);const s=P(t,o,d.zoomValue,n,r),{newPan:a}=oe(m.current,s,c.panDirection,d.zoomValue,n,r,u.current,c.onPan);m.current=a}:void 0,kbZoomCallback:"off"!==d.zooming?e=>{const t=e.dZoom?d.zoomValue+e.dZoom:z(n,r,i);ie(e.nZoom?e.nZoom:t,d.zoomValue,d.minZoom,d.maxZoom,d.onZoom)}:void 0}};function ce({selectedIds:e,selectionMode:t,nodeMap:n,linkMap:o,focusedItemInfo:r,onSelectionChange:i,rootRef:s}){const a=n.itemIdToIndexMap,d=n.itemIndexToIdMap,c=o.itemIdToIndexMap,u=o.itemIndexToIdMap,l=e=>`N_${a.get(e)}`,f=e=>`L_${c.get(e)}`,g=[...e.nodes?e.nodes.map(l):[],...e.links?e.links.map(f):[]];return h.useSelection({selection:g,idExtracter:e=>{const t="keyup"===e.type?r:M(e.target,s);return t.isNode?l(t.id):f(t.id)},selectionMode:t,onChange:e=>{const t=e.ids.filter((e=>"N"===e[0])).map((e=>{return t=e,d.get(Number(t.slice(2)));var t})),n=e.ids.filter((e=>"L"===e[0])).map((e=>{return t=e,u.get(Number(t.slice(2)));var t}));return i&&i({nodes:t,links:n})}})}e.Diagram=function({nodes:e=[],links:n=[],width:r="100%",height:s="140x",selectedIds:d={},selectionMode:h="none",layout:m,nodeRenderer:w,linkRenderer:I,onSelectionChange:v,onItemInput:S,highlightedIds:M={},datatip:N,...z}){const k=o.useRef(null),R=o.useRef(null),[X,Y]=o.useState([]),[T,C]=o.useState(),{direction:L}=a.useUser();if(0===e.length)return null;const Z=e,E=x(Z),O=E.itemIdToDataMap,j=function(e,t){const n=[];for(let o=0;o<e.length;o++){const r=e[o];t.get(r.startNode)&&t.get(r.endNode)&&n.push(r)}return n}(n,O),B=x(j),F=B.itemIdToDataMap;return t.jsx(p.TrackResizeContainer,{width:g.sizeToCSS(r)||"0px",height:g.sizeToCSS(s)||"0px",children:function(e,n){const r=o.useRef(!1),s=function(e){const t=[];for(let n=0;n<e.length;n++)t.push({w:e[n].w,h:e[n].h});return t}(X),{textMeasureContent:g,getTextDimensions:p}=l.useTextDimensions(),x=o.useRef(new Map),K=o.useRef([]),U=o.useRef([]),_=function(e,t){if(0===e.length)return{x:0,w:1/0,y:0,h:1/0};let n,o=1/0,r=1/0,i=-1/0,s=-1/0;for(let t=0;t<e.length;t++)n=e[t],o=n.x<o?n.x:o,r=n.y<r?n.y:r,i=n.x+n.w>i?n.x+n.w:i,s=n.y+n.h>s?n.y+n.h:s;return t&&(o=t.x<o?t.x:o,r=t.y<r?t.y:r,i=t.x+t.w>i?t.x+t.w:i,s=t.y+t.h>s?t.y+t.h:s),{x:o,w:i-o,y:r,h:s-r}}(X,T),{panZoomProps:G,cursor:$,centerX:W,centerY:q,zoomValue:J,kbPanCallback:H,kbZoomCallback:Q}=de({props:z,captureTargetRef:R,width:e,height:n,contentBounds:_}),{focusedItemInfo:ee,hoveredItemInfo:ne,...oe}=te(Z[0],Z,j,X,F,E.itemIdToIndexMap,e,n,z.maxZoom||1,S,H,Q),re=ce({selectedIds:d,selectionMode:h,nodeMap:E,linkMap:B,focusedItemInfo:ee,onSelectionChange:v,rootRef:R});ee&&X.length>0&&(k.current=function(e,t,n,o,r){if(e.isNode)return t[o.get(e.id)||0];{const i=n[r.get(e.id)||0],s=t[o.get(i.startNode)||0],a=t[o.get(i.endNode)||0],d={x:s.x+s.w/2,y:s.y+s.h/2},c={x:a.x+a.w/2,y:a.y+a.h/2};return{x:Math.min(d.x,c.x),y:Math.min(d.y,c.y),w:Math.abs(d.x-c.x),h:Math.abs(d.y-c.y)}}}(ee,X,j,E.itemIdToIndexMap,B.itemIdToIndexMap));const ie=function(e,t,n,o,r){let i;const s=o?.isCurrent;return s&&null!=o.id&&(i=o),n&&n.isCurrent&&(i=n),i&&r?r({data:i.isNode?e.get(i.id):t.get(i.id),type:i.isNode?"node":"link"}):i?(i.isNode?e.get(i.id):t.get(i.id))?.accessibleLabel:void 0}(O,F,ee,ne,N),{datatipContent:se,datatipProps:ae}=(({text:e,focusedItemBoundsRef:t,focusedItemInfo:n,panState:o,zoom:r,width:i})=>{const{direction:s}=a.useUser(),d="rtl"===s,l=n?.isCurrent?{x:t.current.x*r+o.panX,y:t.current.y*r+o.panY,width:t.current.w*r,height:t.current.h*r}:void 0,{datatipContent:f,datatipProps:h}=c.useDatatip({content:e,placement:"top-start",offset:u.calculateOffset(d,i,l),anchor:n?.isCurrent?"element":"pointer"});return{datatipContent:f,datatipProps:h}})({text:ie,focusedItemInfo:ee,focusedItemBoundsRef:k,panState:P(W,q,J,e,n),zoom:J,width:e}),ue={width:e,height:n,cursor:$},le=o.useRef(),fe=le.current?le.current:{selectedNodeIds:[],selectedLinkIds:[],focusedId:void 0,hoveredId:void 0,activeId:void 0,highlightedIds:[],zoom:0};le.current={selectedNodeIds:d.nodes??[],selectedLinkIds:d.links??[],focusedId:ee.isCurrent&&ee.isFocusVisible?ee.id:void 0,hoveredId:ne?.isCurrent?ne.id:void 0,activeId:oe["aria-activedescendant"],highlightedIds:y(M.nodes,M.links),zoom:J};const he=f.mergeProps(G,oe,re,ae);return t.jsxs("div",{ref:R,class:i.outerStyles,...he,style:ue,tabIndex:0,role:"application","aria-label":z["aria-label"],"aria-labelledby":z["aria-labelledby"],"aria-describedby":z["aria-describedby"],children:[p?t.jsx(V,{centerX:W,centerY:q,zoom:J,width:e,height:n,children:t.jsx(A,{nodes:Z,links:j,nodeRenderer:w,linkRenderer:I,width:e,height:n,nodeBounds:X,states:le.current,previousStates:fe,onNodeSizeChanged:(t,o,i)=>{s[i]={w:t,h:o},r.current||(r.current=!0,window.requestAnimationFrame((()=>{const{labelDims:t,layoutJSON:o}=function(e,t,n,o,r,i,s){const a=new Map,d=Array.from(t.keys());for(const e of d){const n=t.get(e);if(n&&s&&n.label){const t=n.label,o=D(n.labelStyle);a.set(e,s(t,o))}}const c=Array.from(n.keys());for(const e of c){const t=n.get(e);if(t&&s&&t.label){const n=t.label,o=D(t.labelStyle);a.set(e,s(n,o))}}return{layoutJSON:{getNodeDimensions:function(t){for(let n=0;n<e.length;n++)if(t.id===e[n].id)return o[n];return o[0]},getLabelDimensions:function(e){return a.get(e.id)},componentSize:{width:r,height:i}},labelDims:a}}(Z,O,F,s,e,n,p);x.current=t;const{nodePoints:i,nodeLabelPos:a,linkLabelPos:d}=function(e,t,n){const o=e.nodes,r=e.links,i=[],s=[],a=[];let d,c,u=!1,l=!1;for(let e=0;e<t.length;e++)d=o[t[e].id],i.push(d.position),d.label&&(u=!0),s.push(d.label);if(r)for(let e=0;e<n.length;e++)c=r[n[e].id],c.label&&(l=!0),a.push(c.label);return{nodePoints:i,nodeLabelPos:u?s:void 0,linkLabelPos:l?a:void 0}}(m(o),Z,j);K.current=a,U.current=d;const c=function(e,t){const n=[];for(let o=0;o<e.length;o++){const r=t[o],i=e[o];n.push({x:r.x,y:r.y,w:i.w,h:i.h})}return n}(s,i);Y(c);const u=function(e,t,n,o=[],r=[],i){if(0===o.length&&0===r.length)return;let s,a,d=1/0,c=1/0,u=-1/0,l=-1/0;for(let n=0;n<o.length;n++)a=o[n],a&&(s=b(a,e.get(t[n].id),i),d=s.x<d?s.x:d,c=s.y<c?s.y:c,u=s.x+s.w>u?s.x+s.w:u,l=s.y+s.h>l?s.y+s.h:l);for(let t=0;t<r.length;t++)a=r[t],a&&(s=b(a,e.get(n[t].id),i),d=s.x<d?s.x:d,c=s.y<c?s.y:c,u=s.x+s.w>u?s.x+s.w:u,l=s.y+s.h>l?s.y+s.h:l);return{x:d,w:u-d,y:c,h:l-c}}(t,Z,j,a,d,"rtl"===L);C(u),r.current=!1})))},nodeLabelPositions:K.current,linkLabelPositions:U.current,labelDimensions:x.current,supportsSelection:"none"!==h||!!(d?.nodes&&d.nodes.length>0)||!!(d?.links&&d.links.length>0)})}):void 0,g,se]})}})}}));
//# sourceMappingURL=Diagram-d36698c3.js.map
