{"version":3,"file":"Legend-cd2f78b2.js","sources":["../../src/UNSAFE_Legend/legendNavUtils.ts","../../src/UNSAFE_Legend/Legend.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport {\n  ItemActionDetail,\n  ItemFocusDetail,\n  ItemHoverDetail,\n  ItemInfo,\n  LegendItemData\n} from '../utils/UNSAFE_visTypes/legend';\n\nfunction getItem<K, D extends LegendItemData<K>>(itemInfo: ItemInfo, items: D[]) {\n  const { itemIdx } = itemInfo;\n\n  if (itemIdx == -1) {\n    return items[items.length - 1];\n  }\n  return items[itemIdx];\n}\n\nfunction getNextItemInfo<K>(itemInfo: ItemInfo, items: LegendItemData<K>[]) {\n  let itemIdx = itemInfo.itemIdx;\n\n  if (itemIdx == -1) {\n    itemIdx = items.length - 1;\n  }\n\n  itemIdx = Math.min(items.length - 1, itemIdx + 1);\n  if (items[itemIdx].actionable !== 'off') {\n    return { sectionIdx: 0, itemIdx };\n  } else if (itemIdx === items.length - 1) {\n    itemIdx = itemIdx - 1;\n    return { sectionIdx: 0, itemIdx };\n  }\n\n  return getNextItemInfo({ sectionIdx: 0, itemIdx }, items);\n}\n\nfunction getPrevItemInfo<K>(itemInfo: ItemInfo, items: LegendItemData<K>[]) {\n  let itemIdx = itemInfo.itemIdx;\n\n  if (itemIdx == -1) {\n    itemIdx = items.length - 1;\n  }\n\n  itemIdx = Math.max(0, itemIdx - 1);\n  if (items[itemIdx].actionable !== 'off') {\n    return { sectionIdx: 0, itemIdx };\n  }\n\n  return getPrevItemInfo({ sectionIdx: 0, itemIdx }, items);\n}\n\n/**\n * Returns utils functions for navigation in simple legend.\n * @param items\n * @returns\n */\nexport function getLegendNavUtils<K extends string | number, D extends LegendItemData<K>>(\n  items: D[]\n) {\n  return {\n    getItem: (itemInfo: ItemInfo) => {\n      return getItem(itemInfo, items);\n    },\n    getDetailFromInfo: (\n      itemInfo?: ItemInfo\n    ): ItemFocusDetail<K, D> | ItemHoverDetail<K, D> | ItemActionDetail<K, D> => {\n      if (!itemInfo) {\n        return { itemId: undefined, data: undefined };\n      }\n      const item = getItem(itemInfo, items);\n      return { itemId: item.id, data: item };\n    },\n    getPrevItemInfo: (itemInfo: ItemInfo) => {\n      return getPrevItemInfo(itemInfo, items);\n    },\n    getNextItemInfo: (itemInfo: ItemInfo) => {\n      return getNextItemInfo(itemInfo, items);\n    }\n  };\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { useRef } from 'preact/hooks';\nimport { BaseLegend } from '../PRIVATE_BaseLegend/BaseLegend';\nimport { useVisEvent } from '../hooks/PRIVATE_useVisEvents/useVisEvents';\nimport { LegendProps } from './legend.type';\nimport { getLegendNavUtils } from './legendNavUtils';\nimport {\n  getAriaProps,\n  getDatatipText,\n  getGridNums,\n  getIsLegendItemActionable,\n  getItemInfo,\n  getLegendTextStyle,\n  isEqualItem\n} from '../utils/PRIVATE_legendUtils/legendUtils';\nimport { mergeProps } from '../utils/UNSAFE_mergeProps';\nimport { useLegendDatatip } from './useLegendDatatip';\nimport { useItemFocus } from '../hooks/PRIVATE_useVisEvents';\nimport { useLegendLayout } from './useLegendLayout';\nimport { styles } from './themes/LegendStyles.css';\nimport { useCssVars } from '../hooks/PRIVATE_useCssVars';\nimport { legendVars, getKeyUpHandler } from '../utils/PRIVATE_legendUtils/legendUtils';\nimport { classNames } from '../utils/UNSAFE_classNames';\nimport { useTestId } from '../hooks/UNSAFE_useTestId';\nimport { useLegendContextMenu } from '../PRIVATE_BaseLegend/useLegendContextMenu';\nimport {\n  ItemFocusDetail,\n  ItemActionDetail,\n  ItemInfo,\n  LegendItemData\n} from '../utils/UNSAFE_visTypes/legend';\nimport { useVisTouchResponse } from '#hooks/PRIVATE_useVisTouchResponse';\nimport { merge } from '#utils/UNSAFE_stringUtils';\n\n/**\n * A legend displays an interactive description of symbols, colors, etc., used in graphical information representations.\n */\nexport function Legend<K extends string | number, D extends LegendItemData<K> = LegendItemData<K>>({\n  orientation = 'horizontal',\n  items,\n  isReadOnly = true,\n  onItemAction,\n  onItemHover,\n  onItemFocus,\n  testId,\n  contextMenuConfig,\n  hideAndShowBehavior = 'off',\n  hoverBehavior = 'none',\n  ...props\n}: LegendProps<K, D>) {\n  const testIdProps = useTestId(testId);\n  const rootRef = useRef<HTMLDivElement>(null);\n  const rootDimsRef = useRef<DOMRect>();\n  const { getItem, getDetailFromInfo, getPrevItemInfo, getNextItemInfo } = getLegendNavUtils<K, D>(\n    items\n  );\n  const { resolvedVars, cssContent } = useCssVars(legendVars);\n  const legendFontStylesObj = getLegendTextStyle(\n    {\n      fontStyle: props.textFontStyle,\n      fontSize: props.textFontSize?.toString(),\n      fontWeight: props.textFontWeight?.toString(),\n      fontFamily: props.textFontFamily\n    },\n    resolvedVars\n  );\n\n  const isLegendItemActionable = getIsLegendItemActionable(items, isReadOnly);\n\n  const { textMeasureContent, layoutInfo } = useLegendLayout({\n    resolvedVars,\n    items,\n    rootRef,\n    rootDimsRef,\n    orientation,\n    legendFontStylesObj,\n    symbolWidth: props.symbolWidth\n  });\n\n  const legendKeyUpHandler = (\n    triggerOnAction: () => void,\n    updatefocusedItemInfo: (itemInfo: ItemInfo) => void,\n    focusedItemInfo: ItemInfo\n  ) =>\n    getKeyUpHandler(\n      triggerOnAction,\n      updatefocusedItemInfo,\n      focusedItemInfo,\n      props.hiddenIds != null\n    );\n\n  const { touchResponse, touchResponseStyle } = useVisTouchResponse({ type: 'touchStart' });\n\n  //shall we put the below useEvent specific snipped in a useLegendEvents?\n  const { focusedItemInfo, hoveredItemInfo, onContextMenuDismissed, activeId, eventsProps } =\n    useVisEvent<ItemInfo, ItemActionDetail<K, D>, ItemFocusDetail<K, D>, D>(\n      touchResponse,\n      !isReadOnly,\n      isLegendItemActionable,\n      legendKeyUpHandler,\n      getDetailFromInfo,\n      getPrevItemInfo,\n      getNextItemInfo,\n      onItemAction,\n      onItemHover,\n      onItemFocus,\n      isEqualItem,\n      getItemInfo,\n      { itemIdx: 0, sectionIdx: 0 },\n      props.hiddenIds != null\n    );\n\n  const { focusedItemRef } = useItemFocus(focusedItemInfo);\n  const datatipText = getDatatipText(items, getItem, focusedItemInfo, hoveredItemInfo);\n  const {\n    datatipContent,\n    datatipProps: { 'aria-describedby': datatipAriaDescribedby, ...datatipProps }\n  } = useLegendDatatip({\n    text: datatipText,\n    rootDimsRef,\n    focusedItemInfo,\n    focusedItemRef,\n    touchResponse\n  });\n\n  const ariaProps = getAriaProps<K>(\n    isReadOnly,\n    props['aria-label'],\n    props.hiddenIds,\n    merge([props['aria-describedby'], datatipAriaDescribedby]),\n    props['aria-labelledby']\n  );\n\n  const { contextMenuContent, contextMenuProps } = useLegendContextMenu<K, D>({\n    rootRef,\n    contextMenuConfig,\n    focusedItemInfo,\n    items,\n    isReadOnly,\n    onContextMenuDismissed\n  });\n\n  const mergedProps = mergeProps(eventsProps, datatipProps, contextMenuProps);\n  const { itemsPerCol, itemsPerRow } = getGridNums(items.length, layoutInfo);\n  const { legendStyle, renderedLegendStyle, preRenderedLegendStyle } = styles;\n  const canRender = orientation === 'vertical' || !!layoutInfo;\n  return (\n    <div\n      ref={rootRef}\n      tabIndex={isReadOnly ? undefined : 0}\n      role=\"application\"\n      class={classNames([legendStyle, canRender ? renderedLegendStyle : preRenderedLegendStyle])}\n      style={touchResponseStyle}\n      {...testIdProps}\n      {...ariaProps}\n      {...mergedProps}\n      aria-activedescendant={activeId}>\n      {canRender ? (\n        <BaseLegend\n          {...props}\n          focusedItemRef={focusedItemRef}\n          items={items}\n          isReadOnly={isReadOnly}\n          orientation={orientation}\n          sectionIdx={0}\n          itemsPerRow={itemsPerRow}\n          itemsPerCol={itemsPerCol}\n          itemWidth={layoutInfo?.isWrapped ? layoutInfo?.maxItemWidth : undefined}\n          focusedItemInfo={focusedItemInfo}\n          hoveredItemInfo={hoveredItemInfo}\n          activeId={activeId}\n          hideAndShowBehavior={hideAndShowBehavior}\n          hoverBehavior={hoverBehavior}\n        />\n      ) : null}\n      {datatipContent}\n      {textMeasureContent}\n      {cssContent}\n      {contextMenuContent}\n    </div>\n  );\n}\n"],"names":["getItem","itemInfo","items","itemIdx","length","getNextItemInfo","Math","min","actionable","sectionIdx","getPrevItemInfo","max","getLegendNavUtils","getDetailFromInfo","itemId","undefined","data","item","id","orientation","isReadOnly","onItemAction","onItemHover","onItemFocus","testId","contextMenuConfig","hideAndShowBehavior","hoverBehavior","props","testIdProps","useTestId","rootRef","useRef","rootDimsRef","resolvedVars","cssContent","useCssVars","legendVars","legendFontStylesObj","getLegendTextStyle","fontStyle","textFontStyle","fontSize","textFontSize","toString","fontWeight","textFontWeight","fontFamily","textFontFamily","isLegendItemActionable","getIsLegendItemActionable","textMeasureContent","layoutInfo","useLegendLayout","symbolWidth","touchResponse","touchResponseStyle","useVisTouchResponse","type","focusedItemInfo","hoveredItemInfo","onContextMenuDismissed","activeId","eventsProps","useVisEvent","triggerOnAction","updatefocusedItemInfo","getKeyUpHandler","hiddenIds","isEqualItem","getItemInfo","focusedItemRef","useItemFocus","datatipText","getDatatipText","datatipContent","datatipProps","datatipAriaDescribedby","useLegendDatatip","text","ariaProps","getAriaProps","merge","contextMenuContent","contextMenuProps","useLegendContextMenu","mergedProps","mergeProps","itemsPerCol","itemsPerRow","getGridNums","legendStyle","renderedLegendStyle","preRenderedLegendStyle","styles","canRender","_jsxs","ref","tabIndex","role","class","classNames","style","children","_jsx","BaseLegend","itemWidth","isWrapped","maxItemWidth"],"mappings":"kYAgBA,SAASA,EAAwCC,EAAoBC,GACnE,MAAMC,QAAEA,GAAYF,EAEpB,OAAgB,GAAZE,EACKD,EAAMA,EAAME,OAAS,GAEvBF,EAAMC,EACf,CAEA,SAASE,EAAmBJ,EAAoBC,GAC9C,IAAIC,EAAUF,EAASE,QAOvB,OALgB,GAAZA,IACFA,EAAUD,EAAME,OAAS,GAG3BD,EAAUG,KAAKC,IAAIL,EAAME,OAAS,EAAGD,EAAU,GACb,QAA9BD,EAAMC,GAASK,WACV,CAAEC,WAAY,EAAGN,WACfA,IAAYD,EAAME,OAAS,GACpCD,GAAoB,EACb,CAAEM,WAAY,EAAGN,YAGnBE,EAAgB,CAAEI,WAAY,EAAGN,WAAWD,EACrD,CAEA,SAASQ,EAAmBT,EAAoBC,GAC9C,IAAIC,EAAUF,EAASE,QAOvB,OALgB,GAAZA,IACFA,EAAUD,EAAME,OAAS,GAG3BD,EAAUG,KAAKK,IAAI,EAAGR,EAAU,GACE,QAA9BD,EAAMC,GAASK,WACV,CAAEC,WAAY,EAAGN,WAGnBO,EAAgB,CAAED,WAAY,EAAGN,WAAWD,EACrD,CAOM,SAAUU,EACdV,GAEA,MAAO,CACLF,QAAUC,GACDD,EAAQC,EAAUC,GAE3BW,kBACEZ,IAEA,IAAKA,EACH,MAAO,CAAEa,YAAQC,EAAWC,UAAMD,GAEpC,MAAME,EAAOjB,EAAQC,EAAUC,GAC/B,MAAO,CAAEY,OAAQG,EAAKC,GAAIF,KAAMC,EAAM,EAExCP,gBAAkBT,GACTS,EAAgBT,EAAUC,GAEnCG,gBAAkBJ,GACTI,EAAgBJ,EAAUC,GAGvC,UC1CgB,UAAmFiB,YACjGA,EAAc,aAAYjB,MAC1BA,EAAKkB,WACLA,GAAa,EAAIC,aACjBA,EAAYC,YACZA,EAAWC,YACXA,EAAWC,OACXA,EAAMC,kBACNA,EAAiBC,oBACjBA,EAAsB,MAAKC,cAC3BA,EAAgB,UACbC,IAEH,MAAMC,EAAcC,YAAUN,GACxBO,EAAUC,SAAuB,MACjCC,EAAcD,EAAAA,UACdhC,QAAEA,EAAOa,kBAAEA,EAAiBH,gBAAEA,EAAeL,gBAAEA,GAAoBO,EACvEV,IAEIgC,aAAEA,EAAYC,WAAEA,GAAeC,EAAUA,WAACC,EAAUA,YACpDC,EAAsBC,EAAAA,mBAC1B,CACEC,UAAWZ,EAAMa,cACjBC,SAAUd,EAAMe,cAAcC,WAC9BC,WAAYjB,EAAMkB,gBAAgBF,WAClCG,WAAYnB,EAAMoB,gBAEpBd,GAGIe,EAAyBC,EAAAA,0BAA0BhD,EAAOkB,IAE1D+B,mBAAEA,EAAkBC,WAAEA,GAAeC,kBAAgB,CACzDnB,eACAhC,QACA6B,UACAE,cACAd,cACAmB,sBACAgB,YAAa1B,EAAM0B,eAefC,cAAEA,EAAaC,mBAAEA,GAAuBC,EAAmBA,oBAAC,CAAEC,KAAM,gBAGpEC,gBAAEA,EAAeC,gBAAEA,EAAeC,uBAAEA,EAAsBC,SAAEA,EAAQC,YAAEA,GAC1EC,cACET,GACCnC,EACD6B,GAnBuB,CACzBgB,EACAC,EACAP,IAEAQ,EAAeA,gBACbF,EACAC,EACAP,EACmB,MAAnB/B,EAAMwC,YAYNvD,EACAH,EACAL,EACAgB,EACAC,EACAC,EACA8C,EAAAA,YACAC,EAAAA,YACA,CAAEnE,QAAS,EAAGM,WAAY,GACP,MAAnBmB,EAAMwC,YAGJG,eAAEA,GAAmBC,EAAYA,aAACb,GAClCc,EAAcC,EAAAA,eAAexE,EAAOF,EAAS2D,EAAiBC,IAC9De,eACJA,EACAC,cAAgB,mBAAoBC,KAA2BD,IAC7DE,mBAAiB,CACnBC,KAAMN,EACNxC,cACA0B,kBACAY,iBACAhB,kBAGIyB,EAAYC,EAAAA,aAChB7D,EACAQ,EAAM,cACNA,EAAMwC,UACNc,EAAKA,MAAC,CAACtD,EAAM,oBAAqBiD,IAClCjD,EAAM,qBAGFuD,mBAAEA,EAAkBC,iBAAEA,GAAqBC,uBAA2B,CAC1EtD,UACAN,oBACAkC,kBACAzD,QACAkB,aACAyC,2BAGIyB,EAAcC,EAAUA,WAACxB,EAAaa,EAAcQ,IACpDI,YAAEA,EAAWC,YAAEA,IAAgBC,EAAWA,YAACxF,EAAME,OAAQgD,IACzDuC,YAAEA,GAAWC,oBAAEA,GAAmBC,uBAAEA,IAA2BC,EAAAA,OAC/DC,GAA4B,aAAhB5E,KAAgCiC,EAClD,OACE4C,EAAAA,KAAA,MAAA,CACEC,IAAKlE,EACLmE,SAAU9E,OAAaL,EAAY,EACnCoF,KAAK,cACLC,MAAOC,EAAAA,WAAW,CAACV,GAAaI,GAAYH,GAAsBC,KAClES,MAAO9C,KACH3B,KACAmD,KACAM,EACmB,wBAAAxB,EACtByC,SAAA,CAAAR,GACCS,MAACC,EAAUA,WAAA,IACL7E,EACJ2C,eAAgBA,EAChBrE,MAAOA,EACPkB,WAAYA,EACZD,YAAaA,EACbV,WAAY,EACZgF,YAAaA,GACbD,YAAaA,EACbkB,UAAWtD,GAAYuD,UAAYvD,GAAYwD,kBAAe7F,EAC9D4C,gBAAiBA,EACjBC,gBAAiBA,EACjBE,SAAUA,EACVpC,oBAAqBA,EACrBC,cAAeA,IAEf,KACHgD,EACAxB,EACAhB,EACAgD,IAGP"}