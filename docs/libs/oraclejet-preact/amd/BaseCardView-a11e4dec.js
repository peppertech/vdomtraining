define(['exports', 'preact/jsx-runtime', 'preact', 'preact/compat', 'preact/hooks', './mergeProps-bcfa6a92', './keys-cc1cb01d', './collectionUtils-6740111c', './useCurrentKey-1d869ff4', './useCollectionFocusRing-64636529', './useTabbableModeSet-b4c18d1a', './useSelection-e2791513', './LayerHost-e95c5f30', 'css!./DragAndDropStyles.styles.css', './useReorderableContext-652356ad', 'css!./ReorderableItemStyles.styles.css', './Selector-039f7481', './HiddenAccessible-037ef42d', './LoadMoreCollection-a6adbc3f', './PRIVATE_BaseCardView/themes/BaseCardViewStyles.css', './classNames-08d99695', './refUtils-d354a169', './logger-0f873e29', './tabbableUtils-3f80fcf5', './useId-c9578d26', './useAnimation-5bd3adfc', './useResizeObserver-c63865cc', './TabbableModeContext-a9c97640', './FocusTrap-eb7cc3d2', './useUser-85c781ea', './useReorderableItem-7fd4d629', './Grid-160f4885', './Flex-56ecdf4c', './PRIVATE_BaseCardView/themes/BaseCardViewContract.css', './Skeleton-5839404b', 'module'], (function(e,t,r,o,s,n,a,i,l,c,d,u,y,m,f,g,h,b,x,p,C,S,R,v,E,I,T,w,A,K,j,k,L,M,O,P){"use strict";function F({currentKey:e,children:r,dragKey:o,setDragKey:n,onReorder:a,rootRef:l,gutterSize:c,columns:d,context:u}){const y=s.useRef(null),m=1===d,f=u.index%d==0,g=u.index%d==d-1,h=p.multiVariantStyles({itemOverlayFront:c}),b=p.multiVariantStyles({itemOverlayFrontVertical:c}),x={itemOverlayFront:m?b:h,itemOverlayRear:m?p.styles.itemOverlayRearVertical:p.styles.itemOverlayRear,itemDragger:p.styles.itemDragger},S=s.useCallback((()=>y?.current?.closest(i.ITEM_SELECTOR)),[]),R=s.useCallback((e=>{e.dataTransfer?.setData("text/cardview-items-key",JSON.stringify(u.metadata.key))}),[u.metadata.key]),{rootProps:v,isDragged:E,overlayZoneBeforeProps:I,overlayZoneAfterProps:T}=j.useReorderableItem({currentKey:e,isDisabled:!a,draggable:!!a,dragKey:o,setDragKey:n,onReorder:a,rootRef:l,ref:y,getItem:S,setTransferData:R,itemStyles:x,itemSelector:i.ITEM_SELECTOR,isVertical:m}),{direction:w}=K.useUser(),A="rtl"===w,k=C.classNames([I?.class,!m&&!A&&f&&p.styles.itemOverlayFrontEdge,!m&&A&&g&&p.styles.itemOverlayFrontEdge]),L=C.classNames([T?.class,!m&&!A&&g&&p.styles.itemOverlayRearEdge,!m&&A&&f&&p.styles.itemOverlayRearEdge]);return t.jsxs("div",{...v,draggable:!1,children:[r,!E&&o&&t.jsxs(t.Fragment,{children:[t.jsx("div",{...I,class:k}),t.jsx("div",{...T,class:L})]})]})}const V=e=>({animationStates:{slideUp:{from:{translateY:"50px"},to:{translateY:"0px"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}},slideDown:{from:{translateY:"-50px"},to:{translateY:"0"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}}},isAnimatedOnMount:!0}),D=(e,t)=>({animationStates:{opacity:{from:{opacity:0},to:{opacity:1},options:{duration:150,delay:50*e,easing:"linear"}}},isAnimatedOnMount:!0,onAnimationEnd:()=>{t.current&&clearTimeout(t.current)}}),B=o.memo((function({children:e,context:r,isTabbable:o,isFocused:n,isFocusRingVisible:a,isSelected:i,selectionMode:l,focusBehavior:c,setIsFocusBehaviorValid:d,initialAnimation:u,isGridLayout:y,updateCardSize:m,reorderItemProps:f}){const g=s.useRef(null),h=s.useRef(),b=r.metadata.key,x=r.index,K=n&&a,j=p.multiVariantStyles({itemFocused:"card"===c&&K?"isItemFocused":"isNotItemFocused",itemInitialOpacity:u?"isTransparent":"isNotTransparent",itemInGridLayout:y?"isInGridLayout":"isNotInGridLayout"}),k=C.classNames([p.styles.itemStyle,j]),L=s.useCallback((e=>{m?.(e.contentRect.width,e.contentRect.height)}),[m]),M=s.useRef(null);T.useResizeObserver(m?g:M,L),s.useLayoutEffect((()=>{if("content"===c&&K){const e=g.current?.firstElementChild?.firstElementChild,t=v.allTabbableElements(e,!0,!0);0===t.length||t.length>1?(R.warn(`${t.length} focusable elements are detected in the card. 'content' focusBehavior is intended only for use when the card has single focusable element. Please specify one focusable element in the card or switch the focusBehavior to 'card'.`),d?.(!1)):t[0].focus()}}),[c,K,d]);const{nodeRef:O,controller:P}=I.useAnimation(u||"none",V(x)),{nodeRef:B,controller:_}=I.useAnimation(u?"opacity":"none",D(x,h));s.useEffect((()=>{void 0!==u&&(h.current=setTimeout((()=>{P.cancel(),_.cancel(),g.current&&(g.current.style.opacity="1")}),1e3))}),[_,P,u]);const z=s.useMemo((()=>void 0===u?S.mergeRefs(g):S.mergeRefs(g,O,B)),[g,O,B,u]),N=f?t.jsx(F,{...f,context:r,children:e(r)}):e(r);return t.jsx("div",{id:E.useId(),ref:z,class:k,role:"gridcell","data-oj-key":b,onKeyDown:e=>{"card"!==c||!o||"ArrowDown"!==e.key&&"ArrowUp"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},"aria-selected":"none"===l?void 0:i,..."number"==typeof b&&{"data-oj-key-type":"number"},children:t.jsx(w.TabbableModeContext.Provider,{value:{isTabbable:o},children:t.jsx(A.FocusTrap,{isDisabled:!o,restoreFocusRef:!1,children:N})})})}),((e,t)=>{return!(!e||!t)&&(e.children===t.children&&e.isTabbable===t.isTabbable&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.initialAnimation===t.initialAnimation&&e.focusBehavior===t.focusBehavior&&i.compareListItemContext(e.context,t.context)&&(r=e.reorderItemProps,o=t.reorderItemProps,r?.currentKey===o?.currentKey&&r?.dragKey===o?.dragKey&&r?.columns===o?.columns));var r,o}));function _({children:e,layout:r,gutterSize:o,columns:s}){const n=M.cardViewVars.gutterSize[o];return"grid"===r?s<1?null:t.jsx(k.Grid,{gridTemplateColumns:`repeat(${s}, 1fr)`,gap:n,children:e}):t.jsx(L.Flex,{wrap:"wrap",gap:n,children:e})}function z({children:e}){const[o,n]=s.useState(!1);return s.useEffect((()=>{setTimeout((()=>{n(!0)}),50)}),[]),o?t.jsx(r.Fragment,{children:e}):t.jsx("div",{class:x.LOADMORE_STYLE_CLASS})}const N=(e,r=25,o,s,n=!0)=>{const a=o||("flex"===e?"60x":"100%"),i=s||"70x";return[...Array(r)].map(((e,r)=>t.jsx(O.Skeleton,{width:a,height:i},n&&`${r}${(new Date).getTime()}`)))},U=e=>t.jsx(z,{children:N(e.layout)}),H=e=>{const r=[t.jsx("div",{class:x.LOADMORE_STYLE_CLASS,children:N(e.layout,1)}),...N(e.layout,24)];return t.jsx(z,{children:r})},Y=()=>t.jsx("div",{class:x.LOADMORE_STYLE_CLASS}),G=e=>{if(e.colCount<1||null==e.cardWidth||null==e.cardHeight)return t.jsx(Y,{});{const r=[],o=e.colCount-e.totalCount%e.colCount,s=o===e.colCount,n=`calc(${e.cardWidth}px)`,a=e.cardHeight?`calc(${e.cardHeight}px)`:"70x",i="flex"===e.layout?n:"100%",l="flex"===e.layout||s?a:"100%",c=t.jsx("div",{class:x.LOADMORE_STYLE_CLASS,children:N(e.layout,1,i,l)});return r.push(c),r.push(N(e.layout,o-1,i,l)),s||r.push(N(e.layout,e.colCount,i,a)),t.jsx(z,{children:r})}},$={all:!1,keys:new Set},W={xs:12,sm:16,md:24,lg:48,xl:64},Z=o.forwardRef((({children:e,data:o,onLoadMore:y=(()=>{}),hasMore:m=!1,getRowKey:g,currentKey:C,onCurrentKeyChange:S,selectionMode:R="none",selectedKeys:v=$,onSelectionChange:E,onReorder:I,viewportConfig:T,focusBehavior:w="card","aria-label":A,"aria-labelledby":K,initialAnimation:k="slideUp",gutterSize:L="sm",columns:M,layout:O,cardSize:P,updateCardSize:F},V)=>{const D=s.useRef(null);s.useImperativeHandle(V,(()=>D.current),[D]);const z=s.useRef(),N=s.useRef(),Y=W[L],Z={layout:O,columns:M,gutterSize:L},J=s.useRef(!0);s.useEffect((()=>{null!=P.height&&null!=P.width&&(J.current=!1)}),[P]);const X="none"===R?void 0:"multiple"===R,q=m||!o||M<1?-1:Math.ceil(o?.length/M),Q=M<1?-1:M,[ee,te]=s.useState(!0),re=ee?w:"card",oe=s.useRef(!1),se=null!=I,ne=s.useRef(!1),[ae,ie]=d.useTabbableModeSet(D,(e=>i.keyExtractor(e,i.ITEM_SELECTOR)),C,S),{currentKeyProps:le}=l.useCurrentKey((e=>i.keyExtractor(e,i.ITEM_SELECTOR)),"multiple"!==R,(()=>i.getPrevNextKeyByCount(o,g,C,-M)),(()=>i.getPrevNextKeyByCount(o,g,C,M)),(()=>i.getPrevNextKeyByCount(o,g,C,-1)),(()=>i.getPrevNextKeyByCount(o,g,C,1)),C,S),[ce,de]=c.useCollectionFocusRing(D,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]);s.useEffect((()=>{if(null!=C&&D.current){const e=i.findElementByKey(D.current,C,i.ITEM_SELECTOR);if(e){if("card"===re){const t=e.closest("[role=gridcell]"),r=D.current.getAttribute("aria-activedescendant");t&&r!==t.id&&(D.current.setAttribute("aria-activedescendant",t.id),oe.current=!0)}oe.current&&(e.scrollIntoView({block:"nearest"}),oe.current=!1)}}}),[C,o,re,se]);const ue=s.useCallback((e=>{E&&(!1===e.value.all&&e.value.keys.size>0&&(z.current=Array.from(e.value.keys.values()).pop()),E(e))}),[z,E]),ye=s.useCallback((e=>{if(o&&E){const t=i.handleSelectionRange(e,o,g);Array.isArray(t)&&("shiftSpace"===e.eventType?z.current=e.value.start:z.current=e.value.end,E({value:{all:!1,keys:new Set(t)},target:null}))}}),[o,E,g]),{selectionProps:me}=u.useSelection((e=>e===D.current?void 0===C?null:C:i.keyExtractor(e,i.ITEM_SELECTOR)),v,R,!1,"toggle",!1,ue,z.current,C,((e,t)=>()=>i.getPrevNextKeyByCount(o,g,e,t?-M:M)),((e,t)=>()=>i.getPrevNextKeyByCount(o,g,e,t?-1:1)),(e=>{if(D.current){const t=i.findElementByKey(D.current,e,i.ITEM_SELECTOR);t&&t.scrollIntoView({block:"nearest"})}}),ye),{reorderProps:fe,reorderItemProps:ge,reorderContext:he,reorderInstructionsId:be,reorderInstructions:xe}=(({currentKey:e,onReorder:t,gutterSize:r,columns:o,rootRef:n,scrollCurrItemIntoView:a})=>{const l=null!=t,[c,d]=s.useState(void 0),{reorderProps:u,reorderContext:y,reorderInstructionsId:m,reorderInstructions:f}=j.useReorderable({onReorder:t,rootRef:n,itemSelector:i.ITEM_SELECTOR,isDisabled:!l,columns:o});return l?{reorderProps:{...u,onDragOver:e=>{i.dragToScroll(e,void 0!==c,n.current),a.current=!1}},reorderItemProps:{currentKey:e,dragKey:c,setDragKey:d,onReorder:t,rootRef:n,gutterSize:r,columns:o},reorderContext:y,reorderInstructionsId:m,reorderInstructions:f}:{reorderProps:u,reorderContext:y,reorderInstructionsId:m,reorderInstructions:f}})({currentKey:C,onReorder:I,gutterSize:L,columns:M,rootRef:D,scrollCurrItemIntoView:oe}),pe=se&&t.jsx(t.Fragment,{children:t.jsx("span",{id:be,children:t.jsx(b.HiddenAccessible,{children:xe})})}),Ce=s.useCallback((()=>{ne.current||(ne.current=!0,y())}),[ne,y]);s.useEffect((()=>{ne.current=!1}),[o,m]);const Se=s.useCallback((e=>{const r=g(e.data),o="multiple"===R?()=>t.jsx(h.Selector,{onChange:E,rowKey:r,selectedKeys:v}):void 0;return{index:e.index,data:e.data,metadata:{key:r},selector:o,isSelected:a.containsKey(v,r)}}),[R,v,E,g]),Re=o&&!o.length&&m?t.jsx(H,{layout:O}):t.jsx(G,{layout:O,colCount:M,totalCount:o?.length||0,cardWidth:P.width,cardHeight:P.height});T=i.getViewportConfig(D,T);const ve=t.jsx("div",{role:"row",children:t.jsx(_,{...Z,children:t.jsx(x.LoadMoreCollection,{data:o,hasMore:m,onLoadMore:Ce,loadMoreIndicator:Re,loadMoreThreshold:Y+4,viewportConfig:T,children:r=>{const o=Se(r),s=ae(o.metadata.key),n=C===o.metadata.key&&!s,a=n&&ce,i=o.isSelected;return(r=>t.jsx(B,{context:r,isTabbable:s,isFocused:n,isFocusRingVisible:a,isGridLayout:"grid"===O,isSelected:i,selectionMode:R,focusBehavior:re,..."content"===w&&{setIsFocusBehaviorValid:te},...J.current&&{initialAnimation:k},...0===o.index&&!P.width&&{updateCardSize:F},...se&&{reorderItemProps:ge},children:e},o.metadata.key))(o)}})})}),Ee=t.jsx(_,{...Z,children:t.jsx(U,{layout:O})});return t.jsxs("div",{...n.mergeProps(le,de,me,fe,{onFocus:()=>{if(!a.isKeyDefined(C)&&S&&ae(void 0)&&D.current){const e=N.current||i.getFirstVisibleKey(D.current,i.ITEM_SELECTOR);a.isKeyDefined(e)&&S({value:e})}else if(a.isKeyDefined(C)&&D.current){const e=i.findElementByKey(D.current,C,i.ITEM_SELECTOR);e?.scrollIntoView({block:"nearest"})}},onPointerDown:e=>{const t=i.keyExtractor(e.target,i.ITEM_SELECTOR);a.isKeyDefined(t)&&(N.current=t)},onKeyDown:e=>{"content"===re&&"Tab"===e.key&&D.current?.focus({preventScroll:!0});se&&(e.metaKey||e.ctrlKey)&&e.shiftKey&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&(oe.current=!0)}},{..."card"===re&&ie}),ref:D,role:"grid",class:p.styles.baseStyle,tabIndex:0,"aria-label":A,"aria-labelledby":K,"aria-multiselectable":X,"aria-rowcount":q,"aria-colcount":Q,children:[t.jsx(f.ReorderableContext.Provider,{value:he,children:o?o.length||m?ve:t.jsx(r.Fragment,{}):Ee}),pe]})}));e.BaseCardView=Z,e.getColCount=(e,t,r)=>{if(!t||!r)return 0;const o=Math.floor((r+e)/(e+t));return Math.max(1,o)},e.gutterSizeToPX=W}));
//# sourceMappingURL=BaseCardView-a11e4dec.js.map
