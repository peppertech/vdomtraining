{"version":3,"file":"useChartDatatip-c702890c.js","sources":["../../src/utils/PRIVATE_chartUtils/dataTipUtils.tsx","../../src/hooks/PRIVATE_useChartDatatip/useChartDatatip.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { ChartItemData, ChartSeriesData, ValueFormats, Group } from '../UNSAFE_visTypes/chart';\nimport { VisTabularDatatip } from '../../PRIVATE_VisTabularDatatip';\nimport { TableRowData } from '../../PRIVATE_VisTabularDatatip';\n\n/**\n * Returns the data required for the VisTabularDatatip to render.\n * @param activeInfo active item info.\n * @param series The array of chart series.\n * @param groups The array of chart groups.\n * @param valueFormats The array of chart series.\n * @param getDataItem function which returns chartItem\n */\nexport function getChartTabularData<K, D extends ChartItemData<K>>(\n  data: D,\n  seriesValue: string,\n  groupValue: string,\n  valueFormats?: ValueFormats,\n  isTimeAxis?: boolean,\n  formatAxisLabel?: (axisValue: number) => string,\n  formatYValue?: (value: number) => string\n) {\n  //TODO: Use translation strings\n  const value = data.value;\n  const itemValue = valueFormats?.value?.format\n    ? valueFormats?.value?.format?.(value)\n    : formatYValue?.(value)!;\n  const tableData: TableRowData[] = [];\n\n  if (valueFormats?.series?.isDisplayed != false) {\n    tableData.push({\n      key: valueFormats?.series?.label || 'Series',\n      value: seriesValue\n    });\n  }\n  if (valueFormats?.group?.isDisplayed != false) {\n    tableData.push({\n      key: valueFormats?.group?.label || (isTimeAxis ? 'Date' : 'Group'),\n      value: isTimeAxis ? formatAxisLabel?.(new Date(groupValue).getTime())! : groupValue\n    });\n  }\n  if (valueFormats?.value?.isDisplayed != false) {\n    tableData.push({\n      key: valueFormats?.value?.label || 'Value',\n      value: itemValue\n    });\n  }\n  return tableData;\n}\n\nexport function getDefaultDatatipRenderer<\n  K extends string | number,\n  D extends ChartItemData<K>\n>(options: {\n  series: ChartSeriesData<K, D>;\n  groups: Group;\n  valueFormats?: ValueFormats;\n  timeAxisType?: 'mixedFrequency' | 'enabled' | 'skipGaps';\n  formatAxisLabel?: (axisValue: number) => string;\n  formatYValue?: (value: number) => string;\n}) {\n  const isMixedFrequency = options.timeAxisType === 'mixedFrequency';\n  const isRegularTimeAxis =\n    options.timeAxisType === 'enabled' || options.timeAxisType === 'skipGaps';\n\n  return (context: { data: D }) => {\n    const groupValue = options.groups.name || options.groups.id;\n    const timeValue = isMixedFrequency\n      ? context.data.x\n      : isRegularTimeAxis\n      ? groupValue\n      : undefined;\n    return {\n      content: (\n        <VisTabularDatatip\n          tableData={getChartTabularData<K, D>(\n            context.data,\n            options.series.name || options.series.id.toString(),\n            timeValue || options.groups.name || options.groups.id,\n            options.valueFormats,\n            options.timeAxisType != null,\n            options.formatAxisLabel,\n            options.formatYValue\n          )}\n        />\n      ),\n      borderColor: context.data.color || options.series.color\n    };\n  };\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { ComponentChildren } from 'preact';\nimport { calculateOffset, useDatatip } from '../PRIVATE_useDatatip';\nimport {\n  DataCursorPosition,\n  Group,\n  ChartItemData,\n  Info,\n  Scale,\n  ValueFormats\n} from '../../utils/UNSAFE_visTypes/chart';\nimport { BarSeriesData } from '../../UNSAFE_BarChart/barChart.types';\nimport { Dimension } from '../../utils/UNSAFE_visTypes/common';\nimport { getDefaultDatatipRenderer } from '../../utils/PRIVATE_chartUtils/dataTipUtils';\nimport { LineAreaSeriesData } from '../../UNSAFE_LineAreaChart/lineAreaChart.types';\nimport { getColorRamp } from '../../utils/UNSAFE_visUtils';\nimport { Placement } from '../../UNSAFE_Floating';\nimport { useUser } from '../../hooks/UNSAFE_useUser';\nimport { Property } from 'csstype';\n\ntype Props<K extends string | number, D extends ChartItemData<K>> = {\n  series: (BarSeriesData<K, D> | LineAreaSeriesData<K, D>)[];\n  groups: Group[];\n  isDataCursorEnabled?: boolean;\n  dataCursorPosition?: DataCursorPosition;\n  isHoriz: boolean;\n  getDataItemPos: (seriesIndex: number, groupIndex: number) => Dimension | undefined;\n  datatip?: (context: { data: D; seriesIndex: number; groupIndex: number; id: K }) => {\n    content: ComponentChildren;\n    borderColor?: Property.BorderColor;\n  };\n  xScale: Scale;\n  getDataItem: (seriesIndex: number, groupIndex: number) => D | undefined;\n  hoveredItemInfo?: Info;\n  focusedItemInfo?: Info;\n  width: number;\n  height: number;\n  valueFormats?: ValueFormats;\n  findNearest: (x: number, y: number) => any;\n  timeAxisType?: 'mixedFrequency' | 'skipGaps' | 'enabled';\n  touchResponse: 'touchStart' | 'touchHold';\n  isDisabled: boolean;\n  formatAxisLabel?: (axisValue: number) => string;\n  formatYValue?: (value: number) => string;\n};\nconst DATA_CURSOR_OFFSET = 10;\n\nexport const useChartDatatip = <K extends string | number, D extends ChartItemData<K>>({\n  isDataCursorEnabled,\n  dataCursorPosition,\n  isHoriz,\n  datatip,\n  xScale,\n  getDataItem,\n  getDataItemPos,\n  hoveredItemInfo,\n  focusedItemInfo,\n  series,\n  valueFormats,\n  groups,\n  width,\n  height,\n  findNearest,\n  timeAxisType,\n  touchResponse,\n  isDisabled,\n  formatAxisLabel,\n  formatYValue\n}: Props<K, D>) => {\n  let activeInfo = !isDisabled\n    ? focusedItemInfo?.isCurrent\n      ? focusedItemInfo\n      : hoveredItemInfo?.isCurrent &&\n        hoveredItemInfo.seriesIndex !== undefined &&\n        hoveredItemInfo.groupIndex !== undefined\n      ? hoveredItemInfo\n      : undefined\n    : undefined;\n\n  const anchor = focusedItemInfo?.isCurrent || isDataCursorEnabled ? 'element' : 'pointer';\n  const elementBounds = focusedItemInfo?.isCurrent\n    ? getDataItemPos(focusedItemInfo.seriesIndex!, focusedItemInfo.groupIndex!)\n    : undefined;\n\n  const { direction } = useUser();\n  const isRtl = direction === 'rtl';\n\n  let placement = 'top-start' as Placement;\n  let offset = calculateOffset(isRtl, width, elementBounds);\n  if (isDataCursorEnabled && dataCursorPosition?.x != null && dataCursorPosition?.y != null) {\n    // TOD0: The offset for data cursor should be calculated according to\n    // datatip content dimensions as well.\n    activeInfo = activeInfo || findNearest?.(dataCursorPosition.x, dataCursorPosition.y);\n    const xPos = xScale.transform(dataCursorPosition.x);\n    offset = { mainAxis: -1, crossAxis: -1 };\n    if (isHoriz) {\n      placement = 'end';\n      offset.mainAxis = -1 * DATA_CURSOR_OFFSET;\n      offset.crossAxis = xPos - height / 2;\n    } else {\n      placement = 'top';\n      offset.crossAxis = isRtl ? width / 2 - xPos : xPos - width / 2;\n      offset.mainAxis = -1 * DATA_CURSOR_OFFSET;\n    }\n  }\n\n  let dtContent;\n  let item: D | undefined;\n  if (activeInfo?.seriesIndex != null && activeInfo?.groupIndex != null) {\n    item = getDataItem(activeInfo.seriesIndex, activeInfo.groupIndex!);\n    const datatipContext = item\n      ? {\n          data: item,\n          seriesIndex: activeInfo.seriesIndex,\n          groupIndex: activeInfo.groupIndex,\n          id: item.id\n        }\n      : undefined;\n\n    if (datatipContext) {\n      const datatipRenderer =\n        datatip ||\n        getDefaultDatatipRenderer({\n          series: series[activeInfo.seriesIndex],\n          groups: groups[activeInfo.groupIndex],\n          valueFormats,\n          timeAxisType,\n          formatAxisLabel,\n          formatYValue\n        });\n      dtContent = datatipRenderer(datatipContext);\n    }\n  }\n  const colors = getColorRamp();\n  const borderColor =\n    dtContent?.borderColor ||\n    (activeInfo &&\n      ((series[activeInfo.seriesIndex!] as BarSeriesData<K, D>).color ||\n        (series[activeInfo.seriesIndex!] as LineAreaSeriesData<K, D>).lineColor ||\n        (series[activeInfo.seriesIndex!] as LineAreaSeriesData<K, D>).areaColor)) ||\n    (activeInfo && colors[activeInfo.seriesIndex! % colors.length]);\n\n  const { datatipContent, datatipProps } = useDatatip({\n    content: dtContent?.content,\n    anchor,\n    placement,\n    offset,\n    borderColor,\n    touchResponse\n  });\n\n  return { datatipContent, datatipProps };\n};\n"],"names":["getChartTabularData","data","seriesValue","groupValue","valueFormats","isTimeAxis","formatAxisLabel","formatYValue","value","itemValue","format","tableData","series","isDisplayed","push","key","label","group","Date","getTime","isDataCursorEnabled","dataCursorPosition","isHoriz","datatip","xScale","getDataItem","getDataItemPos","hoveredItemInfo","focusedItemInfo","groups","width","height","findNearest","timeAxisType","touchResponse","isDisabled","activeInfo","undefined","isCurrent","seriesIndex","groupIndex","anchor","elementBounds","direction","useUser","isRtl","dtContent","item","placement","offset","calculateOffset","x","y","xPos","transform","mainAxis","crossAxis","datatipContext","id","options","isMixedFrequency","isRegularTimeAxis","context","name","timeValue","content","_jsx","jsx","VisTabularDatatip","toString","borderColor","color","getDefaultDatatipRenderer","colors","getColorRamp","lineColor","areaColor","length","datatipContent","datatipProps","useDatatip"],"mappings":"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"}