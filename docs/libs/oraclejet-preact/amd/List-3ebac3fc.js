define(['exports', 'preact/jsx-runtime', 'preact/hooks', './classNames-08d99695', './mergeProps-bcfa6a92', './keys-cc1cb01d', './LoadMoreCollection-a6adbc3f', './VirtualizedCollection-63223f5e', 'preact/compat', './TabbableModeContext-a9c97640', './useId-c9578d26', './FocusTrap-eb7cc3d2', './useInteractionStyle-726087e0', './mergeInterpolations-9ede4cf7', './flexitem-5db48325', './PRIVATE_List/themes/ListStyles.css', './collectionUtils-6740111c', './Skeleton-5839404b', './Flex-56ecdf4c', './Selector-039f7481', './ImageVars.css-17386400', './useTheme-ac980f9a', './useTestId-3a316499', './useSelection-e2791513', './useCurrentKey-1d869ff4', './useCollectionFocusRing-64636529', './useCollectionInteractionContext-173bc431', './useItemAction-66d976c4', './useTabbableModeSet-b4c18d1a', './useReorderableContext-652356ad', './Inset-d7d99801', 'module'], (function(e,t,i,s,r,n,l,o,a,c,u,d,g,m,b,f,y,v,p,h,x,S,k,C,I,w,K,T,R,V,j,A){"use strict";const P=e=>{switch(e){case"listbox":return{list:"listbox",item:"presentation",cell:"option"};case"treegrid":return{list:"treegrid",item:"row",cell:"gridcell"};default:return{list:"grid",item:"row",cell:"gridcell"}}},E="[data-oj-key]";function F({children:e,context:r,itemDepth:n,isFocused:l,isFocusRingVisible:o,isActive:a,isGridlineVisible:y,isSelected:v,isTopGridlineVisible:p=!1,isTabbable:h=!1,role:x,selectionMode:S,suggestion:k,currentItemVariant:C}){const I=i.useRef(null),w=i.useMemo((()=>P(x)),[x]),K=r.metadata.key,T=r.index,R="option"===w.cell?{role:w.cell,"aria-posinset":T+1,"aria-setsize":-1}:{role:w.cell},{interactionProps:V,applyActiveStyle:j,applyHoverStyle:A,applyPseudoHoverStyle:E}=g.useInteractionStyle(),F=f.listItemMultiVariantStyles({selectable:M(S,v)?"isSelectable":"notSelectable",selected:v?"isSelected":"notSelected",selectedSingle:v&&"single"===S?"isSelectedSingle":"notSelectedSingle",needsEventsHover:A?"isNeedsEventsHover":"notNeedsEventsHover",pseudoHover:E?"isPseudoHover":"notPseudoHover",active:j||a?"isActive":"notActive",focusHighlight:"highlight"===C&&l?"isFocusHighlight":"notFocusHighlight",focusRingVisible:o&&l?"isFocusRingVisible":"notFocusRingVisible",gridlineTop:p?"visible":"hidden",gridlineBottom:!y&&("end"!==k||y||v&&"single"===S)?"hidden":"visible"}),L=s.classNames([F]),H=m.mergeInterpolations([...Object.values(b.flexitemInterpolations)]),{class:z,...D}=H({flex:"1 1 auto",alignSelf:"center"}),N=s.classNames([z,"multiple"===S&&f.listItemStyles.checkboxContainer]);return t.jsx("div",{"aria-rowindex":"grid"===x?T+1:void 0,"aria-level":n,"data-oj-key":K,class:L,ref:I,role:w.item,...k&&{"data-oj-suggestion":!0},..."number"==typeof K&&{"data-oj-key-type":"number"},...V,children:t.jsx("div",{id:u.useId(),style:D,class:N,"aria-posinset":"grid"===x?void 0:T+1,"aria-setsize":"grid"===x?void 0:-1,onKeyDown:e=>{!h||"ArrowDown"!==e.key&&"ArrowUp"!==e.key||e.stopPropagation()},"aria-colindex":"grid"===x?1:void 0,"aria-selected":"none"!==S?v:void 0,...R,children:t.jsx(c.TabbableModeContext.Provider,{value:{isTabbable:h},children:t.jsx(d.FocusTrap,{isDisabled:!h,restoreFocusRef:!1,children:e(r)})})})})}const M=(e,t)=>"none"!==e&&("multiple"===e||!t),L=a.memo(F,((e,t)=>!(!e||!t)&&(e.children===t.children&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.isTabbable===t.isTabbable&&e.isActive===t.isActive&&e.suggestion===t.suggestion&&e.isGridlineVisible===t.isGridlineVisible&&e.isTopGridlineVisible===t.isTopGridlineVisible&&y.compareListItemContext(e.context,t.context))));function H({children:e,minimumCount:r=1}){const[n,l]=i.useState(!1);i.useEffect((()=>{setTimeout((()=>{l(!0)}),50)}),[]);const o=s.classNames([f.skeletonStyles.container]);return n&&e?t.jsx("div",{class:o,role:"presentation",children:[...Array(r)].map(((t,i)=>e(i)))}):null}const z="oj-collection-sparkle";function D({sparkleHeight:e}){const{name:i}=S.useTheme();if(e<=0)return null;const r=e+"px",n=s.classNames([f.sparkleStyles.base]),l=s.classNames([f.sparkleStyles.container,z,"redwood"===i&&x.globalImages]);return t.jsx("div",{class:l,children:t.jsx("div",{class:n,style:{height:r}})},"sparkle")}const N=(e,t)=>{if(0===t)return null;return e.slice(0,t).reduce(((e,i,s)=>{const r=i.metadata.key;return s===t-1?e.set(r,"end"):e.set(r,!0),e}),new Map)},O=(e,t,i)=>{if(e&&t&&(e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView({block:"nearest"}),i>0)){const s=t.getBoundingClientRect(),r=e.getBoundingClientRect(),n=s.top+i-r.top;n>0&&(t.scrollTop=t.scrollTop-n)}},G=(e,t)=>{const i=t.data.map((e=>e.metadata.key)),s=i.indexOf(e.value.start),r=i.indexOf(e.value.end),n=Math.min(s,r),l=Math.max(s,r);return-1===n?{offset:0,count:t.totalSize}:i.slice(n,l+1)},B=e=>!(!e.parentElement||!e.parentElement.classList.contains("oj-listview-expander"));const _=(e,t)=>t??{scroller:()=>e.current},U={all:!1,keys:new Set},q=t.jsx(H,{minimumCount:25,children:()=>t.jsx(j.Inset,{variant:"listview",children:t.jsx(p.Flex,{height:"6x",align:"center",children:t.jsx(v.Skeleton,{height:"4x"})})})}),Y=t.jsx("div",{class:l.LOADMORE_STYLE_CLASS,children:t.jsx(H,{minimumCount:3,children:()=>t.jsx(j.Inset,{variant:"listview",children:t.jsx(p.Flex,{height:"6x",align:"center",children:t.jsx(v.Skeleton,{height:"4x"})})})})}),$=(e,t)=>{if(t){const i=Math.min(t.offset,e.offset+e.totalSize),s=i-e.offset;s>0&&(e={offset:i,data:e.data.slice(s,s+t.count),totalSize:e.totalSize,sizePrecision:e.sizePrecision})}return e};e.List=function({"aria-label":e,"aria-labelledby":a,allowTabbableMode:c=!0,children:u,data:d,gridlines:g,loadingIndicator:m=q,currentItemOverride:b,onPersistCurrentItem:v,onLoadRange:p,onSelectionChange:x,onItemAction:S,rangeExtractor:j,role:A="grid",selectedKeys:M=U,selectionMode:H="none",viewportConfig:z,currentItemVariant:J="none",promotedSection:Q,isVirtualized:W=!1,customItemRenderer:X,scrollToVisibleOffset:Z,testId:ee,scrollerRef:te,reorderProps:ie,contextMenuTriggerProps:se,...re}){const ne=i.useRef(null),le=i.useRef(),[oe,ae]=i.useState(!1),ce="none"===H?void 0:"multiple"===H,ue=null===d?void 0:"exact"===d.sizePrecision?d.totalSize:-1,de=s.classNames([f.listStyles.base]),ge=i.useCallback(((e,t)=>{d&&(le.current={detail:e,range:{offset:d.offset,count:d.data.length}},p(t))}),[d,p]),{currentKey:me,onCurrentKeyChange:be,isCurrentItemOverridden:fe}=((e,t)=>{const[s,r]=i.useState(),n=i.useRef(),l=i.useRef(!1),o=V.useReorderableContext(),a=i.useMemo((()=>e=>{r(e.value),t?.(e),null!=o?.currentItemKey&&(o.currentItemKey.current=e.value?.rowKey)}),[t,o?.currentItemKey]);return n.current!==e&&(n.current=e,s?.rowKey!==e?.rowKey&&(l.current=!0,a({value:e}))),i.useEffect((()=>{l.current=!1})),{currentKey:s?.rowKey,onCurrentKeyChange:e=>{a({value:{rowKey:e.value}})},isCurrentItemOverridden:l.current}})(b,v),{eventProps:ye,showFocusRing:ve,handleSelectionChange:pe}=((e,t,s="none",n,l,o,a,c,u="grid",d,g,m,b)=>{const f=i.useMemo((()=>P(u)),[u]),v=i.useRef(),p=K.useCollectionInteractionContext(),{currentKeyProps:h}=I.useCurrentKey((e=>y.keyExtractor(e,E)),"multiple"!==s,y.getPrevNextKey(g.current,e,!0,E),y.getPrevNextKey(g.current,e,!1,E),void 0,void 0,e,n),[x,S]=w.useCollectionFocusRing(g,["ArrowUp","ArrowDown"]);i.useEffect((()=>{if(null!=e&&g.current){const t=y.findElementByKey(g.current,e,E);if(t){const e=g.current.getAttribute("aria-activedescendant"),i=t.querySelector(`[role=${f.cell}]`);if(i&&e!==i.id&&(g.current.setAttribute("aria-activedescendant",i.id),!b||"embedded"===p)){const e=c?.scroller(),i=d?d(g.current):0;O(t,null!=e?e:g.current,i)}}}}),[e,a,f.cell,c,d,g,b]);const k=i.useCallback((e=>{l&&(!1===e.value.all&&e.value.keys.size>0&&(v.current=Array.from(e.value.keys.values()).pop()),l(e))}),[v,l]),R=i.useCallback((e=>{if(a&&l){const t=G(e,a);Array.isArray(t)?("shiftSpace"===e.eventType?v.current=e.value.start:v.current=e.value.end,l({value:{all:!1,keys:new Set(t)},target:null})):m(e,t)}}),[a,l,m]),{selectionProps:V}=C.useSelection((t=>t===g.current?void 0===e?null:e:y.keyExtractor(t,E)),t,s,!1,"replace","embedded"===p,k,v.current,e,((e,t)=>y.getPrevNextKey(g.current,e,t,E)),void 0,(e=>{if(g.current){const t=y.findElementByKey(g.current,e,E);if(t){const e=c?.scroller(),i=d?d(g.current):0;O(t,null!=e?e:g.current,i)}}}),R),j=T.useItemAction(e,a,o,E,"embedded"===p);return{eventProps:r.mergeProps(h,S,V,j),showFocusRing:x,handleSelectionChange:k}})(me,M,H,be,x,S,d,z,A,Z,ne,ge,fe),{eventProps:he,isCurrentTabbableKey:xe}=((e,t,s,l,o,a)=>{const c=i.useRef(),[u,d]=R.useTabbableModeSet(l,(e=>B(e)?null:y.keyExtractor(e,E)),e,t),g=i.useCallback((()=>{if(l.current&&t&&(!s||u(void 0))){const e=c.current||y.getFirstVisibleKey(l.current,E);n.isKeyDefined(e)&&t({value:e})}}),[l,t,s,u]),m=i.useCallback((i=>{if(B(i.target)){l.current?.focus();const e=y.keyExtractor(i.target,E);t&&n.isKeyDefined(e)&&t({value:e})}else if(n.isKeyDefined(e)){if(l.current){const i=y.findElementByKey(l.current,e,E);if(i){const e=o?.scroller(),t=a?a(l.current):0;O(i,null!=e?e:l.current,t)}else t&&g()}}else t&&g()}),[e,g,t,l]),b=i.useCallback((e=>{const t=y.keyExtractor(e.target,E);n.isKeyDefined(t)&&(c.current=t)}),[]);return{eventProps:r.mergeProps(s?d:{},{onFocus:m,onPointerDown:b}),isCurrentTabbableKey:u}})(me,be,c,ne,z,Z);if(d&&void 0!==le.current&&x){const e=G(le.current.detail,d);Array.isArray(e)&&x({value:{all:!1,keys:new Set(e)},target:null});const t=le.current?le.current.range:{offset:d.offset,count:d.data.length};d=$(d,t),le.current=void 0,p(t)}const{sparkleHeight:Se,suggestions:ke}=((e,t,s)=>{const[r,n]=i.useState(0),l=i.useMemo((()=>e&&t&&N(e.data,t.count)),[e,t]);return i.useEffect((()=>{if(l){const e=s.current?.querySelector("."+o.PLACEHOLDER_STYLE_CLASS);let t=e?.offsetHeight||0;const i=s.current?.querySelectorAll("[data-oj-suggestion]");i?.forEach((e=>t+=e.offsetHeight)),n(t)}}),[s,l]),{sparkleHeight:r,suggestions:l}})(d,Q,ne),Ce=t.jsx(D,{sparkleHeight:Se}),Ie=i.useCallback((e=>{const i=e.data,s="multiple"===H?()=>t.jsx(h.Selector,{onChange:pe,rowKey:i.metadata.key,selectedKeys:M}):void 0;return{index:e.index,data:i.data,metadata:i.metadata,selector:s}}),[H,M,pe]),we=W?F:L,Ke=e=>{const i=Ie(e),s=ke?.get(i.metadata.key),r=c&&xe(i.metadata.key),l=me===i.metadata.key&&!r,o=l&&oe,a=n.containsKey(M,i.metadata.key),m=l&&ve,b=(e,r)=>{return t.jsx(we,{context:e,isFocused:l,isFocusRingVisible:m,isActive:o,isGridlineVisible:(n=i.index,"visible"===g?.item&&(n+1!==d?.totalSize||"visible"===g?.bottom)),isSelected:a,isTabbable:c&&xe(i.metadata.key),role:A,selectionMode:H,currentItemVariant:J,...s&&{suggestion:s},...0===i.index&&{isTopGridlineVisible:"visible"===g?.item&&"visible"===g?.top},...r,children:u},i.metadata.key);var n};if(X){return X({listItemContext:i,isFocused:l,isFocusRingVisible:m,isSelected:a,isTabbable:r,isActive:o,defaultListItem:b})}return b(i)};z=_(ne,z);const Te=i.useCallback((e=>{" "===e.key&&n.isKeyDefined(me)&&"none"!==H&&ae(!0)}),[me,H,ae]),Re=i.useCallback((()=>{ae(!1)}),[ae]);i.useImperativeHandle(te,(()=>ne.current));const Ve=k.useTestId(ee);return t.jsx("div",{...r.mergeProps(ye,he,se||{},ie||{},{onKeyDown:Te,onKeyUp:Re},re),...Ve,role:A,"aria-rowcount":"grid"===A?ue:void 0,"aria-colcount":"grid"===A?1:void 0,ref:ne,class:de,tabIndex:0,"aria-label":e,"aria-labelledby":a,"aria-multiselectable":ce,children:null==d?m:W?t.jsx(o.VirtualizedCollection,{data:d,itemSelector:E,loadMoreIndicator:Y,onLoadRange:p,rangeExtractor:j,suggestions:Ce,viewportConfig:z,children:Ke}):t.jsx(l.LoadMoreCollection,{data:d.data,loadMoreIndicator:Y,hasMore:"atLeast"===d.sizePrecision&&d.data.length<=d.totalSize,onLoadMore:()=>{d&&p({offset:0,count:d.data.length+25})},suggestions:Ce,viewportConfig:z,children:Ke})})},e.SkeletonContainer=H,e.excludeGroup=(e,t)=>{if(!t.all){const i=e.data.filter((e=>!e.metadata.isLeaf)).map((e=>e.metadata.key)),s=Array.from(t.keys.values()).filter((e=>!i.includes(e)));return{...t,keys:new Set(s)}}return t},e.scrollToVisible=O}));
//# sourceMappingURL=List-3ebac3fc.js.map
