define("oj-c/hooks/UNSAFE_useListData/useListData",["require","exports","ojs/ojdatacollection-common","ojs/ojdataproviderfactory","preact/hooks"],(function(require,e,t,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getEmptyState=e.useListData=void 0;const s=Object.freeze({status:"loading",data:null}),i={isInitialFetchDeferred:!1};e.useListData=(r,c=i)=>{const u=(0,a.useRef)(null),d=(0,a.useRef)(0),h=(0,a.useRef)(!1),p=(0,a.useRef)(null),b=(0,a.useRef)(null),g=c.fetchSize&&c.fetchSize>0?c.fetchSize:25,S=(0,a.useMemo)((()=>n(r)),[r]),[C,v]=(0,a.useReducer)(o,0===c.initialRowsFetched?(0,e.getEmptyState)("atLeast"):s),x=(0,a.useCallback)((async(e,t)=>{if(null==S)return;const r={attributes:c.attributes,sortCriteria:c.sortCriteria,filterCriterion:c.filterCriterion,offset:e.offset,size:e.count},a=!0===h.current?"exact":"atLeast";if(0!==e.count)try{const s=(await S.fetchByOffset(r)).results;t&&t(s),v({status:"success",data:{offset:e.offset,data:s,totalSize:d.current,sizePrecision:a}})}catch(e){v({status:"error",error:e})}else v({status:"success",data:{offset:e.offset,data:[],totalSize:d.current,sizePrecision:a}})}),[S,c.attributes,c.filterCriterion,c.sortCriteria]),j=(0,a.useCallback)((async()=>{if(null==S)return;"loading"===C.status&&b.current?.abort((0,t.getAbortReason)()),v({status:"loading",data:null});const e=new AbortController;b.current=e;const r=S.fetchFirst({attributes:c.attributes,sortCriteria:c.sortCriteria,filterCriterion:c.filterCriterion,size:g,signal:e.signal})[Symbol.asyncIterator]();p.current=r;try{const e=await r.next();if(r!==p.current)return;const t=e.value.fetchParameters;if(t.signal&&t.signal.aborted)return;d.current=e.value.data.length,void 0!==e.done&&(h.current=e.done);const a=c.initialRowsFetched&&c.initialRowsFetched>0?c.initialRowsFetched:g;x({offset:0,count:Math.min(d.current,a)})}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;v({status:"error",error:e}),p.current=null}}),[S,x,g,c.attributes,c.filterCriterion,c.initialRowsFetched,c.sortCriteria,c.fetchSize]),k=(0,a.useCallback)((async e=>{if(null===p.current)j();else{const t=e.offset+e.count;if(t>d.current){if(null==u.current){const r=l(p,d.current,t);u.current=r;try{const t=await r;void 0!==t.done&&(h.current=t.done);const a=t.total;(a>0||0===a&&h.current)&&(d.current=a,x({offset:e.offset,count:Math.min(d.current-e.offset,e.count)})),u.current=null}catch(e){v({status:"error",error:e}),u.current=null}}}else x(e)}}),[j,x]),w=(0,a.useCallback)((()=>{p.current=null,u.current=null,d.current=0,h.current=!1,0===c.initialRowsFetched?v((0,e.getEmptyState)("atLeast")):c.isInitialFetchDeferred?v({status:"loading",data:null}):j()}),[j,c.isInitialFetchDeferred,c.initialRowsFetched]);(0,a.useEffect)((()=>{S&&w()}),[S,w]);const P=(0,a.useCallback)((e=>{if("success"===C.status&&C.data){const t=C.data;let r,a=t.data.length,s=!1;if(e.detail.add){const r=f(e.detail.add,t,c,!0);d.current=d.current+r,a+=r,s=r>0||"exact"===t.sizePrecision,r<e.detail.add.data.length&&(h.current=!1)}if(e.detail.remove){const r=f(e.detail.remove,t,c,!1);d.current=Math.max(0,d.current-r),a=Math.max(0,a-r),s=s||r>0}const i=e.detail.update;i&&(s=s||y(i,t,c),r=e=>{m(i,t,e)}),s&&x({offset:t.offset,count:a},r)}}),[C,c,x]),E=(0,a.useCallback)((e=>{let t=-1;const r=e.detail?.disregardAfterKey;if(r&&"success"===C.status){const e=C.data.data.findIndex((e=>e.metadata.key===r));if(e>-1&&(t=C.data.data.length-e-1),0===t&&C.data.data.length>=g)return}t>-1&&"success"===C.status?(d.current=d.current-t,k({offset:C.data.offset,count:Math.max(C.data.data.length,g)})):("loading"===C.status&&b.current?.abort(),w())}),[C,g,k,w]);if((0,a.useEffect)((()=>(S&&(S.addEventListener("refresh",E),S.addEventListener("mutate",P)),()=>{S&&(S.removeEventListener("refresh",E),S.removeEventListener("mutate",P))})),[S,w,P,E]),!r){return[(0,e.getEmptyState)("exact"),e=>Promise.resolve()]}return[C,k]};const n=e=>{if(null==e)return null;return(0,r.getEnhancedDataProvider)(e,{fetchFirst:{caching:"visitedByCurrentIterator"}})},o=(e,t)=>e.status===t.status&&"loading"===t.status?e:t,l=async(e,t,r)=>await c(e,t,r),c=async(e,t,r)=>{const a=e.current;if(null===a)return{total:-1,done:void 0};const s=await a.next();return a===e.current?(t+=s.value.data.length)>=r||s.done?{total:t,done:s.done}:c(e,t,r):{total:-1,done:void 0}};e.getEmptyState=e=>"atLeast"===e?u:d;const u=Object.freeze({status:"success",data:{offset:0,data:[],totalSize:0,sizePrecision:"atLeast"}}),d=Object.freeze({status:"success",data:{offset:0,data:[],totalSize:0,sizePrecision:"exact"}}),f=(e,t,r,a)=>{let s=0;if(h(e,r)){const r=a?e.indexes?.sort(((e,t)=>e-t)):e.indexes;let i=t.totalSize-1;r?.forEach((e=>{e<=i&&(s=s+=1,a&&(i=i+=1))}))}else if(a);else{const r=t.data.map((e=>e.metadata.key));e.keys.forEach((e=>{r.includes(e)&&(s+=1)}))}return s},y=(e,t,r)=>{if(h(e,r)){const r=e.indexes?e.indexes:[],a=t.offset,s=a+t.data.length;for(let e=0;e<r.length;e++)if(r[e]>=a&&r[e]<s)return!0}else{const r=Array.from(e.keys),a=t.data.map((e=>e.metadata.key));for(let e=0;e<r.length;e++){const t=r[e];if(a.includes(t))return!0}}return!1},m=(e,t,r)=>{e.keys.forEach((e=>{const a=r.find((t=>t.metadata.key==e)),s=t.data.find((t=>t.metadata.key==e));s&&a&&s.data===a.data&&(a.data=new Proxy(a.data,{}))}))},h=(e,t)=>e.indexes&&null==t.sortCriteria&&null==t.filterCriterion})),define("oj-c/utils/PRIVATE_keyUtils/keySetUtils",["require","exports","ojs/ojkeyset"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getFirstKey=e.isEmpty=e.keysToKeySet=e.keySetToKeys=void 0;e.keySetToKeys=e=>{if(!e)return{all:!1,keys:new Set};let t={};if(e.isAddAll()){t={all:!0,deletedKeys:new Set(e.deletedValues())}}else if(!e.isAddAll()){t={all:!1,keys:new Set(e.values())}}return t};e.keysToKeySet=e=>{let r;return e.all?(r=new t.AllKeySetImpl,r=r.delete(new Set(e.deletedKeys.values()))):e.all||(r=new t.KeySetImpl(new Set(e.keys.values()))),r};e.isEmpty=e=>!e.all&&0===e.keys.size;e.getFirstKey=(e,t)=>{if(!1===e.all&&e.keys.size>0){const[t]=e.keys;return t}return t.length>0?t[0]:null}})),define("oj-c/utils/PRIVATE_collectionUtils/collectionUtils",["require","exports","../PRIVATE_keyUtils/keySetUtils"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.handleOnSelectionChanged=e.getSelectedKeys=void 0;e.getSelectedKeys=(e,r,a,s)=>{const i=e?.keys?.all?r?.data.length:e?.keys.keys?.size;let n;return r&&r.data.length>0&&"singleRequired"===a&&0===i?(n={all:!1,keys:new Set([r.data[0].metadata.key])},s&&s((0,t.keysToKeySet)(n))):n=(0,t.keySetToKeys)(e),n};e.handleOnSelectionChanged=(e,r,a,s)=>{"singleRequired"===e&&0===r.value.keys?.size||a&&!s(r.target)&&a((0,t.keysToKeySet)(r.value))}})),define("oj-c/card-view/useCardViewPreact",["require","exports","preact/hooks","../hooks/UNSAFE_useListData/useListData","../utils/PRIVATE_collectionUtils/collectionUtils"],(function(require,e,t,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useCardViewPreact=void 0;e.useCardViewPreact=({"aria-label":e,"aria-labelledby":s,data:i,gutterSize:n,focusBehavior:o,selected:l,onSelectedChanged:c,scrollPolicyOptions:u,selectionMode:d,initialAnimation:f,columns:y,reorderable:m,onOjReorder:h,skeletonTemplate:p},b,g)=>{const S=(0,t.useRef)(),[C,v]=(0,r.useListData)(i,{fetchSize:u?.fetchSize}),x="error"!==C.status?C.data:null,j=Number.isInteger(y)?y:void 0,k=(0,a.getSelectedKeys)(l,x,d,c);(0,t.useEffect)((()=>{"loading"===C.status?S.current=b("list data is in fetch state"):S.current&&(S.current(),S.current=void 0)}),[C.status]);const w=u?.scroller?{scroller:()=>u.scroller?document.querySelector(u.scroller):null}:void 0,P=(0,t.useCallback)((()=>{if(x){const e=u&&u.fetchSize?u.fetchSize:25;v({offset:0,count:x.data.length+e})}}),[C,u,v]);return{status:C.status,cardViewProps:{"aria-label":e,"aria-labelledby":s,data:x?x.data:null,getRowKey:e=>e.metadata.key,gutterSize:n,hasMore:!!x&&"atLeast"===x.sizePrecision,onLoadMore:P,focusBehavior:o,onSelectionChange:e=>{(0,a.handleOnSelectionChanged)(d,e,c,g)},selectedKeys:k,selectionMode:"singleRequired"===d?"single":d,initialAnimation:f,columns:j,viewportConfig:w,onReorder:"enabled"===m?.items?e=>{h&&h(e)}:null,skeletonRenderer:p}}}})),define("oj-c/hooks/PRIVATE_useSelectionContext/ItemKeyContext",["require","exports","preact"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ItemKeyContext=void 0,e.ItemKeyContext=(0,t.createContext)(void 0)})),define("oj-c/card-view/cardViewItem",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/hooks/UNSAFE_useTabbableMode","../hooks/PRIVATE_useSelectionContext/ItemKeyContext"],(function(require,e,t,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CardViewItem=void 0;e.CardViewItem=({context:e,itemTemplate:s})=>{const{isTabbable:i}=(0,r.useTabbableMode)(),n={isTabbable:i,data:e.data.data,item:e.data};return(0,t.jsx)(a.ItemKeyContext.Provider,{value:e.metadata.key,children:(0,t.jsx)(r.TabbableModeContext.Provider,{value:{isTabbable:i},children:s&&s(n)})})}})),define("oj-c/hooks/PRIVATE_useSelectionContext/SelectionContext",["require","exports","preact"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionContext=void 0,e.SelectionContext=(0,t.createContext)(void 0)})),define("oj-c/card-view/card-view",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/translationBundle","ojs/ojcontext","preact/hooks","ojs/ojvcomponent","preact/compat","@oracle/oraclejet-preact/UNSAFE_CardFlexView","@oracle/oraclejet-preact/UNSAFE_CardGridView","./useCardViewPreact","./cardViewItem","@oracle/oraclejet-preact/hooks/UNSAFE_useTranslationBundle","@oracle/oraclejet-preact/UNSAFE_EmptyList","../hooks/PRIVATE_useSelectionContext/SelectionContext","css!oj-c/card-view/card-view-styles.css"],(function(require,e,t,r,a,s,i,n,o,l,c,u,d,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CardView=void 0;const m=({addBusyState:e,isClickthroughDisabled:r,itemTemplate:a,noData:i,...m})=>{const{status:h,cardViewProps:p}=(0,c.useCardViewPreact)(m,e,r),b=(0,d.useTranslationBundle)("@oracle/oraclejet-preact");if("success"===h&&!p.hasMore&&0===p.data?.length){if(i)return(0,t.jsx)(f.EmptyList,{children:i(n.Children)});{const e=b.noData_message();return(0,t.jsx)(f.EmptyList,{children:e})}}const g={selected:p.selectedKeys,selectionMode:p.selectionMode,onSelectedChange:m.onSelectedChanged},S=(0,s.useCallback)((e=>(0,t.jsx)(u.CardViewItem,{context:e,itemTemplate:a})),[a]);return p.columns?(0,t.jsx)(y.SelectionContext.Provider,{value:g,children:(0,t.jsx)(l.CardGridView,{...p,children:S})}):(0,t.jsx)(y.SelectionContext.Provider,{value:g,children:(0,t.jsx)(o.CardFlexView,{...p,children:S})})};e.CardView=(0,i.registerCustomElement)("oj-c-card-view",(({columns:e="auto",data:r=null,focusBehavior:n="card",gutterSize:o="sm",initialAnimation:l="slideUp",scrollPolicyOptions:c={fetchSize:25},selectionMode:u="none",reorderable:d={items:"disabled"},...f})=>{const y=(0,s.useRef)(),p=(0,s.useCallback)((e=>null!==e&&void 0!==y.current&&h({target:e},y.current)),[]),b=(0,s.useCallback)((e=>y.current?a.getContext(y.current).getBusyContext().addBusyState({description:`oj-c-card-view: ${e}`}):()=>{}),[]),g={columns:e,data:r,focusBehavior:n,gutterSize:o,initialAnimation:l,scrollPolicyOptions:c,selectionMode:u,reorderable:d,...f};return(0,t.jsx)(i.Root,{id:g.id,ref:y,children:(0,t.jsx)(m,{addBusyState:b,isClickthroughDisabled:p,...g})})}),"CardView",{properties:{currentItem:{type:"string|number",readOnly:!0,writeback:!0},data:{type:"DataProvider|null"},gutterSize:{type:"string",enumValues:["xs","sm","md","lg","xl"]},scrollPolicyOptions:{type:"object",properties:{fetchSize:{type:"number"},scroller:{type:"string"}}},selected:{type:"object",writeback:!0},selectionMode:{type:"string",enumValues:["none","multiple","single","singleRequired"]},initialAnimation:{type:"string",enumValues:["slideUp","slideDown"]},focusBehavior:{type:"string",enumValues:["content","card"]},columns:{type:"number|string"},reorderable:{type:"object",properties:{items:{type:"string",enumValues:["disabled","enabled"]}}}},slots:{noData:{data:{}},itemTemplate:{data:{}},skeletonTemplate:{data:{}}},events:{ojReorder:{}},extension:{_WRITEBACK_PROPS:["currentItem","selected"],_READ_ONLY_PROPS:["currentItem"],_OBSERVED_GLOBAL_PROPS:["aria-label","aria-labelledby","id"]}},{columns:"auto",data:null,focusBehavior:"card",gutterSize:"sm",initialAnimation:"slideUp",scrollPolicyOptions:{fetchSize:25},selectionMode:"none",reorderable:{items:"disabled"}},{"@oracle/oraclejet-preact":r.default});const h=function(e,t){let r=e.target;for(;null!=r&&r!==t;){if(p(r))return!0;r=r.parentNode}return!1},p=function(e){return"disabled"===e.dataset.ojClickthrough}})),define("oj-c/card-view",["require","exports","oj-c/card-view/card-view"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CardView=void 0,Object.defineProperty(e,"CardView",{enumerable:!0,get:function(){return t.CardView}})}));
//# sourceMappingURL=card-view.js.map